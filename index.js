// powered by OWNER CASEYRHODES 

CiJ1c2Ugc3RyaWN0IjsKdmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikgewogaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gazsKIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtLCBrKTsKIGlmICghZGVzYyB8fCAoImdldCIgaW4gZGVzYyA/ICFtLl9fZXNNb2R1bGUgOiBkZXNjLndyaXRhYmxlIHx8IGRlc2MuY29uZmlndXJhYmxlKSkgewogZGVzYyA9IHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfTsKIH0KIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgZGVzYyk7Cn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7CiBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrOwogb1trMl0gPSBtW2tdOwp9KSk7CnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikgewogT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sICJkZWZhdWx0IiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTsKfSkgOiBmdW5jdGlvbihvLCB2KSB7CiBvWyJkZWZhdWx0Il0gPSB2Owp9KTsKdmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7CiBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kOwogdmFyIHJlc3VsdCA9IHt9OwogaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09ICJkZWZhdWx0IiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTsKIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7CiByZXR1cm4gcmVzdWx0Owp9Owp2YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHsKIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgImRlZmF1bHQiOiBtb2QgfTsKfTsKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKY29uc3QgYmFpbGV5c18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoIkB3aGlza2V5c29ja2V0cy9iYWlsZXlzIikpOwpjb25zdCBsb2dnZXJfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKCJAd2hpc2tleXNvY2tldHMvYmFpbGV5cy9saWIvVXRpbHMvbG9nZ2VyIikpOwpjb25zdCBsb2dnZXIgPSBsb2dnZXJfMS5kZWZhdWx0LmNoaWxkKHt9KTsKbG9nZ2VyLmxldmVsID0gJ3NpbGVudCc7CmNvbnN0IHBpbm8gPSByZXF1aXJlKCJwaW5vIik7CmNvbnN0IGJvb21fMSA9IHJlcXVpcmUoIkBoYXBpL2Jvb20iKTsKY29uc3QgY29uZiA9IHJlcXVpcmUoIi4vc2V0Iik7CmNvbnN0IGF4aW9zID0gcmVxdWlyZSgiYXhpb3MiKTsKbGV0IGZzID0gcmVxdWlyZSgiZnMtZXh0cmEiKTsKbGV0IHBhdGggPSByZXF1aXJlKCJwYXRoIik7CmNvbnN0IEZpbGVUeXBlID0gcmVxdWlyZSgnZmlsZS10eXBlJyk7CmNvbnN0IHsgU3RpY2tlciwgY3JlYXRlU3RpY2tlciwgU3RpY2tlclR5cGVzIH0gPSByZXF1aXJlKCd3YS1zdGlja2VyLWZvcm1hdHRlcicpOwovL2ltcG9ydCBjaGFsayBmcm9tICdjaGFsaycKY29uc3QgeyB2ZXJpZmllckV0YXRKaWQgLCByZWN1cGVyZXJBY3Rpb25KaWQgfSA9IHJlcXVpcmUoIi4vYmRkL2FudGlsaWVuIik7CmNvbnN0IHsgYXRidmVyaWZpZXJFdGF0SmlkICwgYXRicmVjdXBlcmVyQWN0aW9uSmlkIH0gPSByZXF1aXJlKCIuL2JkZC9hbnRpYm90Iik7CmxldCBldnQgPSByZXF1aXJlKF9fZGlybmFtZSArICIvZnJhbWV3b3JrL3pva291Iik7CmNvbnN0IHtpc1VzZXJCYW5uZWQgLCBhZGRVc2VyVG9CYW5MaXN0ICwgcmVtb3ZlVXNlckZyb21CYW5MaXN0fSA9IHJlcXVpcmUoIi4vYmRkL2JhblVzZXIiKTsKY29uc3Qge2FkZEdyb3VwVG9CYW5MaXN0LGlzR3JvdXBCYW5uZWQscmVtb3ZlR3JvdXBGcm9tQmFuTGlzdH0gPSByZXF1aXJlKCIuL2JkZC9iYW5Hcm91cCIpOwpjb25zdCB7aXNHcm91cE9ubHlBZG1pbixhZGRHcm91cFRvT25seUFkbWluTGlzdCxyZW1vdmVHcm91cEZyb21Pbmx5QWRtaW5MaXN0fSA9IHJlcXVpcmUoIi4vYmRkL29ubHlBZG1pbiIpOwovL2NvbnN0IC8ve2xvYWRDbWR9PXJlcXVpcmUoIi9mcmFtZXdvcmsvbWVzZm9uY3Rpb25zIikKbGV0IHsgcmVhZ2lyIH0gPSByZXF1aXJlKF9fZGlybmFtZSArICIvZnJhbWV3b3JrL2FwcCIpOwp2YXIgc2Vzc2lvbiA9IGNvbmYuc2Vzc2lvbi5yZXBsYWNlKC9QT1BLSUQtTUQ7Ozs9Pi9nLCIiKTsKY29uc3QgcHJlZml4ZSA9IGNvbmYuUFJFRklYRTsKCgphc3luYyBmdW5jdGlvbiBhdXRoZW50aWZpY2F0aW9uKCkgewogdHJ5IHsKIAogLy9jb25zb2xlLmxvZygibGUgZGF0YSAiK2RhdGEpCiBpZiAoIWZzLmV4aXN0c1N5bmMoX19kaXJuYW1lICsgIi9hdXRoL2NyZWRzLmpzb24iKSkgewogY29uc29sZS5sb2coImNvbm5lY3RlZCBzdWNjZXNzZnVsbHkuLi4iKTsKIGF3YWl0IGZzLndyaXRlRmlsZVN5bmMoX19kaXJuYW1lICsgIi9hdXRoL2NyZWRzLmpzb24iLCBhdG9iKHNlc3Npb24pLCAidXRmOCIpOwogLy9jb25zb2xlLmxvZyhzZXNzaW9uKQogfQogZWxzZSBpZiAoZnMuZXhpc3RzU3luYyhfX2Rpcm5hbWUgKyAiL2F1dGgvY3JlZHMuanNvbiIpICYmIHNlc3Npb24gIT0gInpva2siKSB7CiBhd2FpdCBmcy53cml0ZUZpbGVTeW5jKF9fZGlybmFtZSArICIvYXV0aC9jcmVkcy5qc29uIiwgYXRvYihzZXNzaW9uKSwgInV0ZjgiKTsKIH0KIH0KIGNhdGNoIChlKSB7CiBjb25zb2xlLmxvZygiU2Vzc2lvbiBJbnZhbGlkICIgKyBlKTsKIHJldHVybjsKIH0KfQphdXRoZW50aWZpY2F0aW9uKCk7CmNvbnN0IHN0b3JlID0gKDAsIGJhaWxleXNfMS5tYWtlSW5NZW1vcnlTdG9yZSkoewogbG9nZ2VyOiBwaW5vKCkuY2hpbGQoeyBsZXZlbDogInNpbGVudCIsIHN0cmVhbTogInN0b3JlIiB9KSwKfSk7CnNldFRpbWVvdXQoKCkgPT4gewogYXN5bmMgZnVuY3Rpb24gbWFpbigpIHsKIGNvbnN0IHsgdmVyc2lvbiwgaXNMYXRlc3QgfSA9IGF3YWl0ICgwLCBiYWlsZXlzXzEuZmV0Y2hMYXRlc3RCYWlsZXlzVmVyc2lvbikoKTsKIGNvbnN0IHsgc3RhdGUsIHNhdmVDcmVkcyB9ID0gYXdhaXQgKDAsIGJhaWxleXNfMS51c2VNdWx0aUZpbGVBdXRoU3RhdGUpKF9fZGlybmFtZSArICIvYXV0aCIpOwogY29uc3Qgc29ja09wdGlvbnMgPSB7CiB2ZXJzaW9uLAogbG9nZ2VyOiBwaW5vKHsgbGV2ZWw6ICJzaWxlbnQiIH0pLAogYnJvd3NlcjogWydDQVNFWVJIT0RFUy1NRCcsICJzYWZhcmkiLCAiMS4wLjAiXSwKIHByaW50UVJJblRlcm1pbmFsOiB0cnVlLAogZmlyZUluaXRRdWVyaWVzOiBmYWxzZSwKIHNob3VsZFN5bmNIaXN0b3J5TWVzc2FnZTogdHJ1ZSwKIGRvd25sb2FkSGlzdG9yeTogdHJ1ZSwKIHN5bmNGdWxsSGlzdG9yeTogdHJ1ZSwKIGdlbmVyYXRlSGlnaFF1YWxpdHlMaW5rUHJldmlldzogdHJ1ZSwKIG1hcmtPbmxpbmVPbkNvbm5lY3Q6IGZhbHNlLAoga2VlcEFsaXZlSW50ZXJ2YWxNczogMzBfMDAwLAogLyogYXV0aDogc3RhdGUqLyBhdXRoOiB7CiBjcmVkczogc3RhdGUuY3JlZHMsCiAvKiogY2FjaGluZyBtYWtlcyB0aGUgc3RvcmUgZmFzdGVyIHRvIHNlbmQvcmVjdiBtZXNzYWdlcyAqLwoga2V5czogKDAsIGJhaWxleXNfMS5tYWtlQ2FjaGVhYmxlU2lnbmFsS2V5U3RvcmUpKHN0YXRlLmtleXMsIGxvZ2dlciksCiB9LAogLy8vLy8vLy8vLwogZ2V0TWVzc2FnZTogYXN5bmMgKGtleSkgPT4gewogaWYgKHN0b3JlKSB7CiBjb25zdCBtc2cgPSBhd2FpdCBzdG9yZS5sb2FkTWVzc2FnZShrZXkucmVtb3RlSmlkLCBrZXkuaWQsIHVuZGVmaW5lZCk7CiByZXR1cm4gbXNnLm1lc3NhZ2UgfHwgdW5kZWZpbmVkOwogfQogcmV0dXJuIHsKIGNvbnZlcnNhdGlvbjogJ0FuIEVycm9yIE9jY3VycmVkLCBSZXBlYXQgQ29tbWFuZCEnCiB9OwogfQogLy8vLy8vLwogfTsKIGNvbnN0IHprID0gKDAsIGJhaWxleXNfMS5kZWZhdWx0KShzb2NrT3B0aW9ucyk7CiBzdG9yZS5iaW5kKHprLmV2KTsKIAovL3NldEludGVydmFsKCgpID0+IHsgc3RvcmUud3JpdGVUb0ZpbGUoInN0b3JlLmpzb24iKTsgfSwgMzAwMCk7CgovLyBGdW5jdGlvbiB0byBnZXQgdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZSBpbiBLZW55YQpmdW5jdGlvbiBnZXRDdXJyZW50RGF0ZVRpbWUoKSB7CiBjb25zdCBvcHRpb25zID0gewogdGltZVpvbmU6ICdBZnJpY2EvTmFpcm9iaScsIC8vIEtlbnlhIHRpbWUgem9uZQogeWVhcjogJ251bWVyaWMnLAogbW9udGg6ICcyLWRpZ2l0JywKIGRheTogJzItZGlnaXQnLAogaG91cjogJzItZGlnaXQnLAogbWludXRlOiAnMi1kaWdpdCcsCiBzZWNvbmQ6ICcyLWRpZ2l0JywKIGhvdXIxMjogZmFsc2UsIC8vIDI0LWhvdXIgZm9ybWF0CiB9OwogY29uc3QgZGF0ZVRpbWUgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCgnZW4tS0UnLCBvcHRpb25zKS5mb3JtYXQobmV3IERhdGUoKSk7CiByZXR1cm4gZGF0ZVRpbWU7Cn0KCi8vIEF1dG8gQmlvIFVwZGF0ZSBJbnRlcnZhbApzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7CiBpZiAoY29uZi5BVVRPX0JJTyA9PT0gInllcyIpIHsKIGNvbnN0IGN1cnJlbnREYXRlVGltZSA9IGdldEN1cnJlbnREYXRlVGltZSgpOyAvLyBHZXQgdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZQogY29uc3QgYmlvVGV4dCA9IGDwn5G7IOG0hOG0gHPhtIfKj8qAypzhtI/htIXhtIdzLeG0jeG0hSDwn5G7IMmqcyDhtI/JtMqfyarJtOG0hyA6ICR7Y3VycmVudERhdGVUaW1lfWA7IC8vIEZvcm1hdCB0aGUgYmlvIHRleHQKIGF3YWl0IHprLnVwZGF0ZVByb2ZpbGVTdGF0dXMoYmlvVGV4dCk7IC8vIFVwZGF0ZSB0aGUgYmlvCiBjb25zb2xlLmxvZyhgVXBkYXRlZCBCaW86ICR7YmlvVGV4dH1gKTsgLy8gTG9nIHRoZSB1cGRhdGVkIGJpbwogfQp9LCA2MDAwMCk7IC8vIFVwZGF0ZSBiaW8gZXZlcnkgNjAgc2Vjb25kcwoKLy8gRnVuY3Rpb24gdG8gaGFuZGxlIGRlbGV0ZWQgbWVzc2FnZXMKLy8gT3RoZXIgZnVuY3Rpb25zIChhdXRvLXJlYWN0LCBhbnRpLWRlbGV0ZSwgZXRjLikgYXMgbmVlZGVkCiB6ay5ldi5vbigiY2FsbCIsIGFzeW5jIChjYWxsRGF0YSkgPT4gewogaWYgKGNvbmYuQU5USUNBTEwgPT09ICd5ZXMnKSB7CiBjb25zdCBjYWxsSWQgPSBjYWxsRGF0YVswXS5pZDsKIGNvbnN0IGNhbGxlcklkID0gY2FsbERhdGFbMF0uZnJvbTsKCiBhd2FpdCB6ay5yZWplY3RDYWxsKGNhbGxJZCwgY2FsbGVySWQpOwogYXdhaXQgemsuc2VuZE1lc3NhZ2UoY2FsbGVySWQsIHsKIHRleHQ6ICIqc+G0j8qAyoDKjyEhIOG0gOG0jSDhtIThtIBz4bSHyo/KgMqc4bSP4bSF4bSHcyDhtIDJqiDhtIBzc8mqc+G0m+G0gMm04bSbIOG0jcqPIOG0j+G0ocm04bSHyoAg4bSE4bSAybTJtOG0j+G0myzKgOG0h+G0hMmq4bSH4bSg4bSHIOG0hOG0gMqfyp9zIMm04bSP4bShIOG0i8mqybThtIXKn8qPIMqf4bSH4bSA4bSg4bSHIOG0gCDhtI3htIdzc+G0gMmi4bSHLOG0m8qc4bSAybThtIsgyo/htI/htJwuKlxuXG4+IOG0mOG0j+G0oeG0h8qA4bSH4bSFIMqZyo8g4bSE4bSAc+G0h8qPyoDKnOG0j+G0heG0h3Mgc+G0nOG0mOG0mOG0j8qA4bSbIOG0m+G0h+G0gOG0jS4iCiB9KTsKIH0KfSk7CgogLy8gRGVmYXVsdCBhdXRvLXJlcGx5IG1lc3NhZ2UKbGV0IGF1dG9fcmVwbHlfbWVzc2FnZSA9ICLKnMmqIOG0gOG0jSDhtIThtIBz4bSHyo/KgMqc4bSP4bSF4bSHcyDhtI3htIUg4bSAyaog4bSAc3PJqnPhtJvhtIDJtOG0myDKnOG0j+G0oSDhtI3htIDKjyDJqiDKnOG0h8qf4bSYIMqP4bSP4bScLOG0m8qP4bSY4bSHIC5tZW51IOG0m+G0jyBz4bSH4bSHIOG0jcqPIMqfyapz4bSbIOG0j9KTIOG0hOG0j+G0j8qfIOG0hOG0j+G0jeG0jeG0gMm04bSFcy5cblxuPiDhtJjhtI/htKHhtIfKgOG0h+G0hSDKmcqPIOG0hOG0gHPhtIfKj8qAypzhtI/htIXhtIdzIOG0jeG0hSBz4bSc4bSY4bSY4bSPyoDhtJsg4bSb4bSH4bSA4bSNLiI7CgovLyBUcmFjayBjb250YWN0cyB0aGF0IGhhdmUgYWxyZWFkeSByZWNlaXZlZCB0aGUgYXV0by1yZXBseQpsZXQgcmVwbGllZENvbnRhY3RzID0gbmV3IFNldCgpOwoKemsuZXYub24oIm1lc3NhZ2VzLnVwc2VydCIsIGFzeW5jIChtKSA9PiB7CiBjb25zdCB7IG1lc3NhZ2VzIH0gPSBtOwogY29uc3QgbXMgPSBtZXNzYWdlc1swXTsKIGlmICghbXMubWVzc2FnZSkgcmV0dXJuOwoKIGNvbnN0IG1lc3NhZ2VUZXh0ID0gbXMubWVzc2FnZS5jb252ZXJzYXRpb24gfHwgbXMubWVzc2FnZS5leHRlbmRlZFRleHRNZXNzYWdlPy50ZXh0OwogY29uc3QgcmVtb3RlSmlkID0gbXMua2V5LnJlbW90ZUppZDsKCiAvLyBDaGVjayBpZiB0aGUgbWVzc2FnZSBleGlzdHMgYW5kIGlzIGEgY29tbWFuZCB0byBzZXQgYSBuZXcgYXV0by1yZXBseSBtZXNzYWdlIHdpdGggYW55IHByZWZpeAogaWYgKG1lc3NhZ2VUZXh0ICYmIG1lc3NhZ2VUZXh0Lm1hdGNoKC9eW15cd1xzXS8pICYmIG1zLmtleS5mcm9tTWUpIHsKIGNvbnN0IHByZWZpeCA9IG1lc3NhZ2VUZXh0WzBdOyAvLyBEZXRlY3QgdGhlIHByZWZpeAogY29uc3QgY29tbWFuZCA9IG1lc3NhZ2VUZXh0LnNsaWNlKDEpLnNwbGl0KCIgIilbMF07IC8vIENvbW1hbmQgYWZ0ZXIgcHJlZml4CiBjb25zdCBuZXdNZXNzYWdlID0gbWVzc2FnZVRleHQuc2xpY2UocHJlZml4Lmxlbmd0aCArIGNvbW1hbmQubGVuZ3RoKS50cmltKCk7IC8vIE5ldyBtZXNzYWdlIGNvbnRlbnQKCiAvLyBVcGRhdGUgdGhlIGF1dG8tcmVwbHkgbWVzc2FnZSBpZiB0aGUgY29tbWFuZCBpcyAnc2V0YXV0b3JlcGx5JwogaWYgKGNvbW1hbmQgPT09ICJzZXRhdXRvcmVwbHkiICYmIG5ld01lc3NhZ2UpIHsKIGF1dG9fcmVwbHlfbWVzc2FnZSA9IG5ld01lc3NhZ2U7CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShyZW1vdGVKaWQsIHsKIHRleHQ6IGBBdXRvLXJlcGx5IG1lc3NhZ2UgaGFzIGJlZW4gdXBkYXRlZCB0bzpcbiIke2F1dG9fcmVwbHlfbWVzc2FnZX0iYCwKIH0pOwogcmV0dXJuOwogfQogfQoKIC8vIENoZWNrIGlmIGF1dG8tcmVwbHkgaXMgZW5hYmxlZCwgY29udGFjdCBoYXNuJ3QgcmVjZWl2ZWQgYSByZXBseSwgYW5kIGl0J3MgYSBwcml2YXRlIGNoYXQKIGlmIChjb25mLkFVVE9fUkVQTFkgPT09ICJ5ZXMiICYmICFyZXBsaWVkQ29udGFjdHMuaGFzKHJlbW90ZUppZCkgJiYgIW1zLmtleS5mcm9tTWUgJiYgIXJlbW90ZUppZC5pbmNsdWRlcygiQGcudXMiKSkgewogYXdhaXQgemsuc2VuZE1lc3NhZ2UocmVtb3RlSmlkLCB7CiB0ZXh0OiBhdXRvX3JlcGx5X21lc3NhZ2UsCiB9KTsKCiAvLyBBZGQgY29udGFjdCB0byByZXBsaWVkIHNldCB0byBwcmV2ZW50IHJlcGVhdCByZXBsaWVzCiByZXBsaWVkQ29udGFjdHMuYWRkKHJlbW90ZUppZCk7CiB9Cn0pOwogCiAvLyBGdW5jdGlvbiB0byBkb3dubG9hZCBhbmQgcmV0dXJuIG1lZGlhIGJ1ZmZlcgphc3luYyBmdW5jdGlvbiBkb3dubG9hZE1lZGlhKG1lc3NhZ2UpIHsKIGNvbnN0IG1lZGlhVHlwZSA9IE9iamVjdC5rZXlzKG1lc3NhZ2UpWzBdLnJlcGxhY2UoJ01lc3NhZ2UnLCAnJyk7IC8vIERldGVybWluZSB0aGUgbWVkaWEgdHlwZQogdHJ5IHsKIGNvbnN0IHN0cmVhbSA9IGF3YWl0IHprLmRvd25sb2FkQ29udGVudEZyb21NZXNzYWdlKG1lc3NhZ2VbbWVkaWFUeXBlXSwgbWVkaWFUeXBlKTsKIGxldCBidWZmZXIgPSBCdWZmZXIuZnJvbShbXSk7CiBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHN0cmVhbSkgewogYnVmZmVyID0gQnVmZmVyLmNvbmNhdChbYnVmZmVyLCBjaHVua10pOwogfQogcmV0dXJuIGJ1ZmZlcjsKIH0gY2F0Y2ggKGVycm9yKSB7CiBjb25zb2xlLmVycm9yKCdFcnJvciBkb3dubG9hZGluZyBtZWRpYTonLCBlcnJvcik7CiByZXR1cm4gbnVsbDsKIH0KfQoKLy8gRnVuY3Rpb24gdG8gZm9ybWF0IG5vdGlmaWNhdGlvbiBtZXNzYWdlCmZ1bmN0aW9uIGNyZWF0ZU5vdGlmaWNhdGlvbihkZWxldGVkTWVzc2FnZSkgewogY29uc3QgZGVsZXRlZEJ5ID0gZGVsZXRlZE1lc3NhZ2Uua2V5LnBhcnRpY2lwYW50IHx8IGRlbGV0ZWRNZXNzYWdlLmtleS5yZW1vdGVKaWQ7CgogLy8gRm9ybWF0IHRpbWUgaW4gTmFpcm9iaSB0aW1lem9uZQogY29uc3QgdGltZUluTmFpcm9iaSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KCdlbi1LRScsIHsKIHRpbWVab25lOiAnQWZyaWNhL05haXJvYmknLAogZGF0ZVN0eWxlOiAnZnVsbCcsCiB0aW1lU3R5bGU6ICdtZWRpdW0nLAogfSkuZm9ybWF0KG5ldyBEYXRlKCkpOwoKIGxldCBub3RpZmljYXRpb24gPSBgKlsg4bSN4bSHc3PhtIDJouG0hyDhtIXhtIfKn+G0h+G0m8mq4bSPybQg4bSF4bSH4bSb4bSH4bSE4bSb4bSH4bSFIF0qXG5cbmA7CiBub3RpZmljYXRpb24gKz0gYCrwn42ARGVsZXRpb24gVGltZToqICR7dGltZUluTmFpcm9iaX1cbmA7CiBub3RpZmljYXRpb24gKz0gYCrwn5GkRGVsZXRlZCBCeToqIEAke2RlbGV0ZWRCeS5zcGxpdCgnQCcpWzBdfVxuXG5gOwoKIHJldHVybiBub3RpZmljYXRpb247Cn0KCi8vIEV2ZW50IGxpc3RlbmVyIGZvciBhbGwgaW5jb21pbmcgbWVzc2FnZXMKemsuZXYub24oIm1lc3NhZ2VzLnVwc2VydCIsIGFzeW5jIChtKSA9PiB7CiBpZiAoY29uZi5BTlRJREVMRVRFRE0gPT09ICJ5ZXMiKSB7IC8vIENoZWNrIGlmIEFOVElERUxFVEUgaXMgZW5hYmxlZAogY29uc3QgeyBtZXNzYWdlcyB9ID0gbTsKIGNvbnN0IG1zID0gbWVzc2FnZXNbMF07CiBpZiAoIW1zLm1lc3NhZ2UpIHJldHVybjsKCiBjb25zdCBtZXNzYWdlS2V5ID0gbXMua2V5OwogY29uc3QgcmVtb3RlSmlkID0gbWVzc2FnZUtleS5yZW1vdGVKaWQ7CgogLy8gU3RvcmUgbWVzc2FnZSBmb3IgZnV0dXJlIHJlZmVyZW5jZQogaWYgKCFzdG9yZS5jaGF0c1tyZW1vdGVKaWRdKSB7CiBzdG9yZS5jaGF0c1tyZW1vdGVKaWRdID0gW107CiB9CiBzdG9yZS5jaGF0c1tyZW1vdGVKaWRdLnB1c2gobXMpOwoKIC8vIEhhbmRsZSBkZWxldGVkIG1lc3NhZ2VzCiBpZiAobXMubWVzc2FnZS5wcm90b2NvbE1lc3NhZ2UgJiYgbXMubWVzc2FnZS5wcm90b2NvbE1lc3NhZ2UudHlwZSA9PT0gMCkgewogY29uc3QgZGVsZXRlZEtleSA9IG1zLm1lc3NhZ2UucHJvdG9jb2xNZXNzYWdlLmtleTsKIGNvbnN0IGNoYXRNZXNzYWdlcyA9IHN0b3JlLmNoYXRzW3JlbW90ZUppZF07CiBjb25zdCBkZWxldGVkTWVzc2FnZSA9IGNoYXRNZXNzYWdlcy5maW5kKAogKG1zZykgPT4gbXNnLmtleS5pZCA9PT0gZGVsZXRlZEtleS5pZAogKTsKCiBpZiAoZGVsZXRlZE1lc3NhZ2UpIHsKIHRyeSB7CiBjb25zdCBub3RpZmljYXRpb24gPSBjcmVhdGVOb3RpZmljYXRpb24oZGVsZXRlZE1lc3NhZ2UpOwoKIC8vIERldGVybWluZSBtZXNzYWdlIHR5cGUKIGNvbnN0IG10eXBlID0gT2JqZWN0LmtleXMoZGVsZXRlZE1lc3NhZ2UubWVzc2FnZSlbMF07CgogLy8gSGFuZGxlIHRleHQgbWVzc2FnZXMgKGNvbnZlcnNhdGlvbiBvciBleHRlbmRlZFRleHRNZXNzYWdlKQogaWYgKG10eXBlID09PSAnY29udmVyc2F0aW9uJyB8fCBtdHlwZSA9PT0gJ2V4dGVuZGVkVGV4dE1lc3NhZ2UnKSB7CiBhd2FpdCB6ay5zZW5kTWVzc2FnZSh6ay51c2VyLmlkLCB7CiB0ZXh0OiBub3RpZmljYXRpb24gKyBgKk1lc3NhZ2U6KiAke2RlbGV0ZWRNZXNzYWdlLm1lc3NhZ2VbbXR5cGVdLnRleHR9XG5cbj4g4bSY4bSP4bSh4bSHyoDhtIfhtIUgypnKjyDhtIThtIBz4bSHyo/KgMqc4bSP4bSF4bSHcyDKnOG0gOG0hOG0i8mqybTJoiDhtJvhtIfhtIDhtI0uYCwKIG1lbnRpb25zOiBbZGVsZXRlZE1lc3NhZ2Uua2V5LnBhcnRpY2lwYW50XSwKIH0pOwogfQogLy8gSGFuZGxlIG1lZGlhIG1lc3NhZ2VzIChpbWFnZSwgdmlkZW8sIGRvY3VtZW50LCBhdWRpbywgc3RpY2tlciwgdm9pY2UpCiBlbHNlIGlmIChtdHlwZSA9PT0gJ2ltYWdlTWVzc2FnZScgfHwgbXR5cGUgPT09ICd2aWRlb01lc3NhZ2UnIHx8IG10eXBlID09PSAnZG9jdW1lbnRNZXNzYWdlJyB8fAogbXR5cGUgPT09ICdhdWRpb01lc3NhZ2UnIHx8IG10eXBlID09PSAnc3RpY2tlck1lc3NhZ2UnIHx8IG10eXBlID09PSAndm9pY2VNZXNzYWdlJykgewogY29uc3QgbWVkaWFCdWZmZXIgPSBhd2FpdCBkb3dubG9hZE1lZGlhKGRlbGV0ZWRNZXNzYWdlLm1lc3NhZ2UpOwogaWYgKG1lZGlhQnVmZmVyKSB7CiBjb25zdCBtZWRpYVR5cGUgPSBtdHlwZS5yZXBsYWNlKCdNZXNzYWdlJywgJycpLnRvTG93ZXJDYXNlKCk7CiBhd2FpdCB6ay5zZW5kTWVzc2FnZSh6ay51c2VyLmlkLCB7CiBbbWVkaWFUeXBlXTogbWVkaWFCdWZmZXIsCiBjYXB0aW9uOiBub3RpZmljYXRpb24sCiBtZW50aW9uczogW2RlbGV0ZWRNZXNzYWdlLmtleS5wYXJ0aWNpcGFudF0sCiB9KTsKIH0KIH0KIH0gY2F0Y2ggKGVycm9yKSB7CiBjb25zb2xlLmVycm9yKCdFcnJvciBoYW5kbGluZyBkZWxldGVkIG1lc3NhZ2U6JywgZXJyb3IpOwogfQogfQogfQogfQp9KTsKCiAvLyBFdmVudCBsaXN0ZW5lciBmb3IgYWxsIGluY29taW5nIG1lc3NhZ2VzCnprLmV2Lm9uKCJtZXNzYWdlcy51cHNlcnQiLCBhc3luYyAobSkgPT4gewogLy8gQ2hlY2sgaWYgQU5USURFTEVURSBpcyBlbmFibGVkCiBpZiAoY29uZi5BRE1HUk9VUCA9PT0gInllcyIpIHsKIGNvbnN0IHsgbWVzc2FnZXMgfSA9IG07CiBjb25zdCBtcyA9IG1lc3NhZ2VzWzBdOwogaWYgKCFtcy5tZXNzYWdlKSByZXR1cm47CgogLy8gU3RvcmUgZWFjaCByZWNlaXZlZCBtZXNzYWdlCiBjb25zdCBtZXNzYWdlS2V5ID0gbXMua2V5OwogY29uc3QgcmVtb3RlSmlkID0gbWVzc2FnZUtleS5yZW1vdGVKaWQ7CgogLy8gU3RvcmUgbWVzc2FnZSBmb3IgZnV0dXJlIHVuZGVsZXRlIHJlZmVyZW5jZQogaWYgKCFzdG9yZS5jaGF0c1tyZW1vdGVKaWRdKSB7CiBzdG9yZS5jaGF0c1tyZW1vdGVKaWRdID0gW107CiB9CgogLy8gU2F2ZSB0aGUgcmVjZWl2ZWQgbWVzc2FnZSB0byBzdG9yYWdlCiBzdG9yZS5jaGF0c1tyZW1vdGVKaWRdLnB1c2gobXMpOwoKIC8vIEhhbmRsZSBkZWxldGVkIG1lc3NhZ2VzCiBpZiAobXMubWVzc2FnZS5wcm90b2NvbE1lc3NhZ2UgJiYgbXMubWVzc2FnZS5wcm90b2NvbE1lc3NhZ2UudHlwZSA9PT0gMCkgewogY29uc3QgZGVsZXRlZEtleSA9IG1zLm1lc3NhZ2UucHJvdG9jb2xNZXNzYWdlLmtleTsKCiAvLyBTZWFyY2ggZm9yIHRoZSBkZWxldGVkIG1lc3NhZ2UgaW4gdGhlIHN0b3JlZCBtZXNzYWdlcwogY29uc3QgY2hhdE1lc3NhZ2VzID0gc3RvcmUuY2hhdHNbcmVtb3RlSmlkXTsKIGNvbnN0IGRlbGV0ZWRNZXNzYWdlID0gY2hhdE1lc3NhZ2VzLmZpbmQoCiAobXNnKSA9PiBtc2cua2V5LmlkID09PSBkZWxldGVkS2V5LmlkCiApOwoKIGlmIChkZWxldGVkTWVzc2FnZSkgewogdHJ5IHsKIC8vIENyZWF0ZSBub3RpZmljYXRpb24gYWJvdXQgdGhlIGRlbGV0ZWQgbWVzc2FnZQogY29uc3Qgbm90aWZpY2F0aW9uID0gY3JlYXRlTm90aWZpY2F0aW9uKGRlbGV0ZWRNZXNzYWdlKTsKCiAvLyBSZXNlbmQgZGVsZXRlZCBjb250ZW50IGJhc2VkIG9uIGl0cyB0eXBlCiBpZiAoZGVsZXRlZE1lc3NhZ2UubWVzc2FnZS5jb252ZXJzYXRpb24pIHsKIC8vIFRleHQgbWVzc2FnZQogYXdhaXQgemsuc2VuZE1lc3NhZ2UocmVtb3RlSmlkLCB7CiB0ZXh0OiBub3RpZmljYXRpb24gKyBgKvCfk5ZEZWxldGVkIE1lc3NhZ2U6KiAke2RlbGV0ZWRNZXNzYWdlLm1lc3NhZ2UuY29udmVyc2F0aW9ufVxuXG4+IOG0mOG0j+G0oeG0h8qA4bSH4bSFIMqZyo8g4bSE4bSAc+G0h8qPyoDKnOG0j+G0heG0h3Mgc+G0nOG0mOG0mOG0j8qA4bSbIOG0m+G0h+G0gOG0jS5gLAogbWVudGlvbnM6IFtkZWxldGVkTWVzc2FnZS5rZXkucGFydGljaXBhbnRdLAogfSk7CiB9IGVsc2UgaWYgKGRlbGV0ZWRNZXNzYWdlLm1lc3NhZ2UuaW1hZ2VNZXNzYWdlIHx8IAogZGVsZXRlZE1lc3NhZ2UubWVzc2FnZS52aWRlb01lc3NhZ2UgfHwgCiBkZWxldGVkTWVzc2FnZS5tZXNzYWdlLmRvY3VtZW50TWVzc2FnZSB8fCAKIGRlbGV0ZWRNZXNzYWdlLm1lc3NhZ2UuYXVkaW9NZXNzYWdlIHx8IAogZGVsZXRlZE1lc3NhZ2UubWVzc2FnZS5zdGlja2VyTWVzc2FnZSB8fCAKIGRlbGV0ZWRNZXNzYWdlLm1lc3NhZ2Uudm9pY2VNZXNzYWdlKSB7CiAvLyBNZWRpYSBtZXNzYWdlIChpbWFnZSwgdmlkZW8sIGRvY3VtZW50LCBhdWRpbywgc3RpY2tlciwgdm9pY2UpCiBjb25zdCBtZWRpYUJ1ZmZlciA9IGF3YWl0IGRvd25sb2FkTWVkaWEoZGVsZXRlZE1lc3NhZ2UubWVzc2FnZSk7CiBpZiAobWVkaWFCdWZmZXIpIHsKIGNvbnN0IG1lZGlhVHlwZSA9IGRlbGV0ZWRNZXNzYWdlLm1lc3NhZ2UuaW1hZ2VNZXNzYWdlID8gJ2ltYWdlJyA6CiBkZWxldGVkTWVzc2FnZS5tZXNzYWdlLnZpZGVvTWVzc2FnZSA/ICd2aWRlbycgOgogZGVsZXRlZE1lc3NhZ2UubWVzc2FnZS5kb2N1bWVudE1lc3NhZ2UgPyAnZG9jdW1lbnQnIDoKIGRlbGV0ZWRNZXNzYWdlLm1lc3NhZ2UuYXVkaW9NZXNzYWdlID8gJ2F1ZGlvJyA6CiBkZWxldGVkTWVzc2FnZS5tZXNzYWdlLnN0aWNrZXJNZXNzYWdlID8gJ3N0aWNrZXInIDogJ2F1ZGlvJzsKCiBhd2FpdCB6ay5zZW5kTWVzc2FnZShyZW1vdGVKaWQsIHsKIFttZWRpYVR5cGVdOiBtZWRpYUJ1ZmZlciwKIGNhcHRpb246IG5vdGlmaWNhdGlvbiwKIG1lbnRpb25zOiBbZGVsZXRlZE1lc3NhZ2Uua2V5LnBhcnRpY2lwYW50XSwKIH0pOwogfQogfQogfSBjYXRjaCAoZXJyb3IpIHsKIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGhhbmRsaW5nIGRlbGV0ZWQgbWVzc2FnZTonLCBlcnJvcik7CiB9CiB9CiB9CiB9Cn0pOwoKIAogY29uc3QgZGVsYXkgPSBtcyA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTsKCi8vIFRyYWNrIHRoZSBsYXN0IHJlYWN0aW9uIHRpbWUgdG8gcHJldmVudCBvdmVyZmxvdwpsZXQgbGFzdFJlYWN0aW9uVGltZSA9IDA7CiAvKi8vIEF1dG8tcmVhY3QgdG8gc3RhdHVzIHVwZGF0ZXMsIGhhbmRsaW5nIGVhY2ggc3RhdHVzIG9uZS1ieS1vbmUgd2l0aG91dCB0cmFja2luZwppZiAoY29uZi5BVVRPX0xJS0VfU1RBVFVTID09PSAieWVzIikgewogY29uc29sZS5sb2coIkFVVE9fTElLRV9TVEFUVVMgaXMgZW5hYmxlZC4gTGlzdGVuaW5nIGZvciBzdGF0dXMgdXBkYXRlcy4uLiIpOwoKIHprLmV2Lm9uKCJtZXNzYWdlcy51cHNlcnQiLCBhc3luYyAobSkgPT4gewogY29uc3QgeyBtZXNzYWdlcyB9ID0gbTsKCiBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgbWVzc2FnZXMpIHsKIC8vIENoZWNrIGlmIHRoZSBtZXNzYWdlIGlzIGEgc3RhdHVzIHVwZGF0ZQogaWYgKG1lc3NhZ2Uua2V5ICYmIG1lc3NhZ2Uua2V5LnJlbW90ZUppZCA9PT0gInN0YXR1c0Bicm9hZGNhc3QiKSB7CiBjb25zb2xlLmxvZygiRGV0ZWN0ZWQgc3RhdHVzIHVwZGF0ZSBmcm9tOiIsIG1lc3NhZ2Uua2V5LnJlbW90ZUppZCk7CgogLy8gRW5zdXJlIHRocm90dGxpbmcgYnkgY2hlY2tpbmcgdGhlIGxhc3QgcmVhY3Rpb24gdGltZQogY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKIGlmIChub3cgLSBsYXN0UmVhY3Rpb25UaW1lIDwgNTAwMCkgeyAvLyA1LXNlY29uZCBpbnRlcnZhbAogY29uc29sZS5sb2coIlRocm90dGxpbmcgcmVhY3Rpb25zIHRvIHByZXZlbnQgb3ZlcmZsb3cuIik7CiBjb250aW51ZTsKIH0KCiAvLyBDaGVjayBpZiBib3QgdXNlciBJRCBpcyBhdmFpbGFibGUKIGNvbnN0IGJlbHRhaCA9IHprLnVzZXIgJiYgemsudXNlci5pZCA/IHprLnVzZXIuaWQuc3BsaXQoIjoiKVswXSArICJAcy53aGF0c2FwcC5uZXQiIDogbnVsbDsKIGlmICghYmVsdGFoKSB7CiBjb25zb2xlLmxvZygiQm90J3MgdXNlciBJRCBub3QgYXZhaWxhYmxlLiBTa2lwcGluZyByZWFjdGlvbi4iKTsKIGNvbnRpbnVlOwogfQoKIC8vIFJlYWN0IHRvIHRoZSBzdGF0dXMgd2l0aCBhIGdyZWVuIGhlYXJ0CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShtZXNzYWdlLmtleS5yZW1vdGVKaWQsIHsKIHJlYWN0OiB7CiBrZXk6IG1lc3NhZ2Uua2V5LAogdGV4dDogIvCflqQiLCAvLyBSZWFjdGlvbiBlbW9qaQogfSwKIH0sIHsKIHN0YXR1c0ppZExpc3Q6IFttZXNzYWdlLmtleS5wYXJ0aWNpcGFudCwgYmVsdGFoXSwKIH0pOwoKIC8vIExvZyBzdWNjZXNzZnVsIHJlYWN0aW9uIGFuZCB1cGRhdGUgdGhlIGxhc3QgcmVhY3Rpb24gdGltZQogbGFzdFJlYWN0aW9uVGltZSA9IERhdGUubm93KCk7CiBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IHJlYWN0ZWQgdG8gc3RhdHVzIHVwZGF0ZSBieSAke21lc3NhZ2Uua2V5LnJlbW90ZUppZH1gKTsKCiAvLyBEZWxheSB0byBhdm9pZCByYXBpZCByZWFjdGlvbnMKIGF3YWl0IGRlbGF5KDIwMDApOyAvLyAyLXNlY29uZCBkZWxheSBiZXR3ZWVuIHJlYWN0aW9ucwogfQogfQogfSk7CiB9Ki8KIC8vIEF1dG8tcmVhY3QgdG8gc3RhdHVzIHVwZGF0ZXMsIGhhbmRsaW5nIGVhY2ggc3RhdHVzIG9uZS1ieS1vbmUgd2l0aG91dCB0cmFja2luZwppZiAoY29uZi5BVVRPX1JFQUNUX1NUQVRVUyA9PT0gInllcyIpIHsKIHprLmV2Lm9uKCJtZXNzYWdlcy51cHNlcnQiLCBhc3luYyAobSkgPT4gewogY29uc3QgeyBtZXNzYWdlcyB9ID0gbTsKIAogZm9yIChjb25zdCBtZXNzYWdlIG9mIG1lc3NhZ2VzKSB7CiBpZiAobWVzc2FnZS5rZXkgJiYgbWVzc2FnZS5rZXkucmVtb3RlSmlkID09PSAic3RhdHVzQGJyb2FkY2FzdCIpIHsKIHRyeSB7CiBjb25zdCBhZGFtcyA9IHprLnVzZXIgJiYgemsudXNlci5pZCA/IHprLnVzZXIuaWQuc3BsaXQoIjoiKVswXSArICJAcy53aGF0c2FwcC5uZXQiIDogbnVsbDsKCiBpZiAoYWRhbXMpIHsKIC8vIFJlYWN0IHRvIHRoZSBzdGF0dXMgd2l0aCBhIGdyZWVuIGhlYXJ0CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShtZXNzYWdlLmtleS5yZW1vdGVKaWQsIHsKIHJlYWN0OiB7CiBrZXk6IG1lc3NhZ2Uua2V5LAogdGV4dDogIvCfq4UiLAogfSwKIH0sIHsKIHN0YXR1c0ppZExpc3Q6IFttZXNzYWdlLmtleS5wYXJ0aWNpcGFudCwgYWRhbXNdLAogfSk7CgogLy8gSW50cm9kdWNlIGEgc2hvcnQgZGVsYXkgYmV0d2VlbiBlYWNoIHJlYWN0aW9uIHRvIHByZXZlbnQgb3ZlcmZsb3cKIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyMDAwKSk7IC8vIDItc2Vjb25kIGRlbGF5CiB9CiB9IGNhdGNoIChlcnJvcikgewogY29uc29sZS5lcnJvcigiRXJyb3IgZGVjb2RpbmcgSklEIG9yIHNlbmRpbmcgbWVzc2FnZToiLCBlcnJvcik7CiB9CiB9CiB9CiB9KTsKIH0KIAogemsuZXYub24oIm1lc3NhZ2VzLnVwc2VydCIsIGFzeW5jIChtKSA9PiB7CiBjb25zdCB7IG1lc3NhZ2VzIH0gPSBtOwogY29uc3QgbXMgPSBtZXNzYWdlc1swXTsKIGlmICghbXMubWVzc2FnZSkKIHJldHVybjsKIGNvbnN0IGRlY29kZUppZCA9IChqaWQpID0+IHsKIGlmICghamlkKQogcmV0dXJuIGppZDsKIGlmICgvOlxkK0AvZ2kudGVzdChqaWQpKSB7CiBsZXQgZGVjb2RlID0gKDAsIGJhaWxleXNfMS5qaWREZWNvZGUpKGppZCkgfHwge307CiByZXR1cm4gZGVjb2RlLnVzZXIgJiYgZGVjb2RlLnNlcnZlciAmJiBkZWNvZGUudXNlciArICdAJyArIGRlY29kZS5zZXJ2ZXIgfHwgamlkOwogfQogZWxzZQogcmV0dXJuIGppZDsKIH07CiB2YXIgbXR5cGUgPSAoMCwgYmFpbGV5c18xLmdldENvbnRlbnRUeXBlKShtcy5tZXNzYWdlKTsKIHZhciB0ZXh0ZSA9IG10eXBlID09ICJjb252ZXJzYXRpb24iID8gbXMubWVzc2FnZS5jb252ZXJzYXRpb24gOiBtdHlwZSA9PSAiaW1hZ2VNZXNzYWdlIiA/IG1zLm1lc3NhZ2UuaW1hZ2VNZXNzYWdlPy5jYXB0aW9uIDogbXR5cGUgPT0gInZpZGVvTWVzc2FnZSIgPyBtcy5tZXNzYWdlLnZpZGVvTWVzc2FnZT8uY2FwdGlvbiA6IG10eXBlID09ICJleHRlbmRlZFRleHRNZXNzYWdlIiA/IG1zLm1lc3NhZ2U/LmV4dGVuZGVkVGV4dE1lc3NhZ2U/LnRleHQgOiBtdHlwZSA9PSAiYnV0dG9uc1Jlc3BvbnNlTWVzc2FnZSIgPwogbXM/Lm1lc3NhZ2U/LmJ1dHRvbnNSZXNwb25zZU1lc3NhZ2U/LnNlbGVjdGVkQnV0dG9uSWQgOiBtdHlwZSA9PSAibGlzdFJlc3BvbnNlTWVzc2FnZSIgPwogbXMubWVzc2FnZT8ubGlzdFJlc3BvbnNlTWVzc2FnZT8uc2luZ2xlU2VsZWN0UmVwbHk/LnNlbGVjdGVkUm93SWQgOiBtdHlwZSA9PSAibWVzc2FnZUNvbnRleHRJbmZvIiA/CiAobXM/Lm1lc3NhZ2U/LmJ1dHRvbnNSZXNwb25zZU1lc3NhZ2U/LnNlbGVjdGVkQnV0dG9uSWQgfHwgbXMubWVzc2FnZT8ubGlzdFJlc3BvbnNlTWVzc2FnZT8uc2luZ2xlU2VsZWN0UmVwbHk/LnNlbGVjdGVkUm93SWQgfHwgbXMudGV4dCkgOiAiIjsKIHZhciBvcmlnaW5lTWVzc2FnZSA9IG1zLmtleS5yZW1vdGVKaWQ7CiB2YXIgaWRCb3QgPSBkZWNvZGVKaWQoemsudXNlci5pZCk7CiB2YXIgc2VydkJvdCA9IGlkQm90LnNwbGl0KCdAJylbMF07CiAvKiBjb25zdCBkaj0nMjI1NTk3NjM0NDcnOwogY29uc3QgZGoyPScyMjUwMTQzMzQzMzU3JzsKIGNvbnN0IGx1ZmZ5PScyMjg5MTczMzMwMCcqLwogLyogdmFyIHN1cGVyVXNlcj1bc2VydkJvdCxkaixkajIsbHVmZnldLm1hcCgocyk9PnMucmVwbGFjZSgvW14wLTldL2cpKyJAcy53aGF0c2FwcC5uZXQiKS5pbmNsdWRlcyhhdXRldXJNZXNzYWdlKTsKIHZhciBkZXYgPVtkaixkajIsbHVmZnldLm1hcCgodCk9PnQucmVwbGFjZSgvW14wLTldL2cpKyJAcy53aGF0c2FwcC5uZXQiKS5pbmNsdWRlcyhhdXRldXJNZXNzYWdlKTsqLwogY29uc3QgdmVyaWZHcm91cGUgPSBvcmlnaW5lTWVzc2FnZT8uZW5kc1dpdGgoIkBnLnVzIik7CiB2YXIgaW5mb3NHcm91cGUgPSB2ZXJpZkdyb3VwZSA/IGF3YWl0IHprLmdyb3VwTWV0YWRhdGEob3JpZ2luZU1lc3NhZ2UpIDogIiI7CiB2YXIgbm9tR3JvdXBlID0gdmVyaWZHcm91cGUgPyBpbmZvc0dyb3VwZS5zdWJqZWN0IDogIiI7CiB2YXIgbXNnUmVwb25kdSA9IG1zLm1lc3NhZ2UuZXh0ZW5kZWRUZXh0TWVzc2FnZT8uY29udGV4dEluZm8/LnF1b3RlZE1lc3NhZ2U7CiB2YXIgYXV0ZXVyTXNnUmVwb25kdSA9IGRlY29kZUppZChtcy5tZXNzYWdlPy5leHRlbmRlZFRleHRNZXNzYWdlPy5jb250ZXh0SW5mbz8ucGFydGljaXBhbnQpOwogLy9tcy5tZXNzYWdlLmV4dGVuZGVkVGV4dE1lc3NhZ2U/LmNvbnRleHRJbmZvPy5tZW50aW9uZWRKaWQKIC8vIG1zLm1lc3NhZ2UuZXh0ZW5kZWRUZXh0TWVzc2FnZT8uY29udGV4dEluZm8/LnF1b3RlZE1lc3NhZ2UuCiB2YXIgbXIgPSBtcy5tZXNzYWdlPy5leHRlbmRlZFRleHRNZXNzYWdlPy5jb250ZXh0SW5mbz8ubWVudGlvbmVkSmlkOwogdmFyIHV0aWxpc2F0ZXVyID0gbXIgPyBtciA6IG1zZ1JlcG9uZHUgPyBhdXRldXJNc2dSZXBvbmR1IDogIiI7CiB2YXIgYXV0ZXVyTWVzc2FnZSA9IHZlcmlmR3JvdXBlID8gKG1zLmtleS5wYXJ0aWNpcGFudCA/IG1zLmtleS5wYXJ0aWNpcGFudCA6IG1zLnBhcnRpY2lwYW50KSA6IG9yaWdpbmVNZXNzYWdlOwogaWYgKG1zLmtleS5mcm9tTWUpIHsKIGF1dGV1ck1lc3NhZ2UgPSBpZEJvdDsKIH0KIAogdmFyIG1lbWJyZUdyb3VwZSA9IHZlcmlmR3JvdXBlID8gbXMua2V5LnBhcnRpY2lwYW50IDogJyc7CiBjb25zdCB7IGdldEFsbFN1ZG9OdW1iZXJzIH0gPSByZXF1aXJlKCIuL2JkZC9zdWRvIik7CiBjb25zdCBub21BdXRldXJNZXNzYWdlID0gbXMucHVzaE5hbWU7CiBjb25zdCBkaiA9ICcyNTQxMTIxOTIxMTknOwogY29uc3QgZGoyID0gJzI1NDExMjE5MjExOSc7CiBjb25zdCBkajMgPSAiMjU0MTEyMTkyMTE5IjsKIGNvbnN0IGx1ZmZ5ID0gJzI1NDEwMTAyMjU1MSc7CiBjb25zdCBzdWRvID0gYXdhaXQgZ2V0QWxsU3Vkb051bWJlcnMoKTsKIGxldCBnb2F0ID0gIjI1NDExMjE5MjExOSI7CiBjb25zdCBzdXBlclVzZXJOdW1iZXJzID0gW3NlcnZCb3QsIGdvYXQsIGRqLCBkajIsIGRqMywgbHVmZnksIGNvbmYuTlVNRVJPX09XTkVSXS5tYXAoKHMpID0+IHMucmVwbGFjZSgvW14wLTldL2cpICsgIkBzLndoYXRzYXBwLm5ldCIpOwogY29uc3QgYWxsQWxsb3dlZE51bWJlcnMgPSBzdXBlclVzZXJOdW1iZXJzLmNvbmNhdChzdWRvKTsKIGNvbnN0IHN1cGVyVXNlciA9IGFsbEFsbG93ZWROdW1iZXJzLmluY2x1ZGVzKGF1dGV1ck1lc3NhZ2UpOwogCiB2YXIgZGV2ID0gW2RqLCBkajIsZGozLGx1ZmZ5XS5tYXAoKHQpID0+IHQucmVwbGFjZSgvW14wLTldL2cpICsgIkBzLndoYXRzYXBwLm5ldCIpLmluY2x1ZGVzKGF1dGV1ck1lc3NhZ2UpOwogZnVuY3Rpb24gcmVwb25kcmUobWVzKSB7IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IHRleHQ6IG1lcyB9LCB7IHF1b3RlZDogbXMgfSk7IH0KIGNvbnNvbGUubG9nKCJcdCBbXVtdLi4ue2Nhc2V5cmhvZGVzLU1kfS4uLltdW10iKTsKIGNvbnNvbGUubG9nKCI9PT09PT09PT09PSBOZXcgbWVzc2FnZSA9PT09PT09PT09PSIpOwogaWYgKHZlcmlmR3JvdXBlKSB7CiBjb25zb2xlLmxvZygibWVzc2FnZSBzZW50IGZyb20gOiAiICsgbm9tR3JvdXBlKTsKIH0KIGNvbnNvbGUubG9nKCJtZXNzYWdlIGZyb20gOiAiICsgIlsiICsgbm9tQXV0ZXVyTWVzc2FnZSArICIgOiAiICsgYXV0ZXVyTWVzc2FnZS5zcGxpdCgiQHMud2hhdHNhcHAubmV0IilbMF0gKyAiIF0iKTsKIGNvbnNvbGUubG9nKCJ0eXBlIG9mIG1lc3NhZ2UgOiAiICsgbXR5cGUpOwogY29uc29sZS5sb2coIi0tLS0tLWVuZCBvZiB5b3VyIG1lc3NhZ2VzIC0tLS0tLSIpOwogY29uc29sZS5sb2codGV4dGUpOwogLyoqICovCiBmdW5jdGlvbiBncm91cGVBZG1pbihtZW1icmVHcm91cGUpIHsKIGxldCBhZG1pbiA9IFtdOwogZm9yIChtIG9mIG1lbWJyZUdyb3VwZSkgewogaWYgKG0uYWRtaW4gPT0gbnVsbCkKIGNvbnRpbnVlOwogYWRtaW4ucHVzaChtLmlkKTsKIH0KIC8vIGVsc2V7YWRtaW49IGZhbHNlO30KIHJldHVybiBhZG1pbjsKIH0KCiB2YXIgZXRhdCA9Y29uZi5FVEFUOwogaWYoZXRhdD09MSkKIHthd2FpdCB6ay5zZW5kUHJlc2VuY2VVcGRhdGUoImF2YWlsYWJsZSIsb3JpZ2luZU1lc3NhZ2UpO30KIGVsc2UgaWYoZXRhdD09MikKIHthd2FpdCB6ay5zZW5kUHJlc2VuY2VVcGRhdGUoImNvbXBvc2luZyIsb3JpZ2luZU1lc3NhZ2UpO30KIGVsc2UgaWYoZXRhdD09MykKIHsKIGF3YWl0IHprLnNlbmRQcmVzZW5jZVVwZGF0ZSgicmVjb3JkaW5nIixvcmlnaW5lTWVzc2FnZSk7CiB9CiBlbHNlCiB7CiBhd2FpdCB6ay5zZW5kUHJlc2VuY2VVcGRhdGUoInVuYXZhaWxhYmxlIixvcmlnaW5lTWVzc2FnZSk7CiB9CgogY29uc3QgbWJyZSA9IHZlcmlmR3JvdXBlID8gYXdhaXQgaW5mb3NHcm91cGUucGFydGljaXBhbnRzIDogJyc7CiAvLyBjb25zdCB2ZXJpZkFkbWluID0gdmVyaWZHcm91cGUgPyBhd2FpdCBtYnJlLmZpbHRlcih2ID0+IHYuYWRtaW4gIT09IG51bGwpLm1hcCh2ID0+IHYuaWQpIDogJycKIGxldCBhZG1pbnMgPSB2ZXJpZkdyb3VwZSA/IGdyb3VwZUFkbWluKG1icmUpIDogJyc7CiBjb25zdCB2ZXJpZkFkbWluID0gdmVyaWZHcm91cGUgPyBhZG1pbnMuaW5jbHVkZXMoYXV0ZXVyTWVzc2FnZSkgOiBmYWxzZTsKIHZhciB2ZXJpZlpva291QWRtaW4gPSB2ZXJpZkdyb3VwZSA/IGFkbWlucy5pbmNsdWRlcyhpZEJvdCkgOiBmYWxzZTsKIC8qKiAqKiAqLwogLyoqICoqKioqICovCiBjb25zdCBhcmcgPSB0ZXh0ZSA/IHRleHRlLnRyaW0oKS5zcGxpdCgvICsvKS5zbGljZSgxKSA6IG51bGw7CiBjb25zdCB2ZXJpZkNvbSA9IHRleHRlID8gdGV4dGUuc3RhcnRzV2l0aChwcmVmaXhlKSA6IGZhbHNlOwogY29uc3QgY29tID0gdmVyaWZDb20gPyB0ZXh0ZS5zbGljZSgxKS50cmltKCkuc3BsaXQoLyArLykuc2hpZnQoKS50b0xvd2VyQ2FzZSgpIDogZmFsc2U7CiAKIAogY29uc3QgbGllbiA9IGNvbmYuVVJMLnNwbGl0KCcsJykgCgogCiAvLyBVdGlsaXNlciB1bmUgYm91Y2xlIGZvci4uLm9mIHBvdXIgcGFyY291cmlyIGxlcyBsaWVucwpmdW5jdGlvbiBteWJvdHBpYygpIHsKIC8vIEfDqW7DqXJlciB1biBpbmRpY2UgYWzDqWF0b2lyZSBlbnRyZSAwIChpbmNsdXMpIGV0IGxhIGxvbmd1ZXVyIGR1IHRhYmxlYXUgKGV4Y2x1cykKIC8vIEfDqW7DqXJlciB1biBpbmRpY2UgYWzDqWF0b2lyZSBlbnRyZSAwIChpbmNsdXMpIGV0IGxhIGxvbmd1ZXVyIGR1IHRhYmxlYXUgKGV4Y2x1cykKIGNvbnN0IGluZGljZUFsZWF0b2lyZSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGxpZW4ubGVuZ3RoKTsKIC8vIFLDqWN1cMOpcmVyIGxlIGxpZW4gY29ycmVzcG9uZGFudCDDoCBsJ2luZGljZSBhbMOpYXRvaXJlCiBjb25zdCBsaWVuQWxlYXRvaXJlID0gbGllbltpbmRpY2VBbGVhdG9pcmVdOwogcmV0dXJuIGxpZW5BbGVhdG9pcmU7CiB9CiB2YXIgY29tbWFuZGVPcHRpb25zID0gewogc3VwZXJVc2VyLCBkZXYsCiB2ZXJpZkdyb3VwZSwKIG1icmUsCiBtZW1icmVHcm91cGUsCiB2ZXJpZkFkbWluLAogaW5mb3NHcm91cGUsCiBub21Hcm91cGUsCiBhdXRldXJNZXNzYWdlLAogbm9tQXV0ZXVyTWVzc2FnZSwKIGlkQm90LAogdmVyaWZab2tvdUFkbWluLAogcHJlZml4ZSwKIGFyZywKIHJlcG9uZHJlLAogbXR5cGUsCiBncm91cGVBZG1pbiwKIG1zZ1JlcG9uZHUsCiBhdXRldXJNc2dSZXBvbmR1LAogbXMsCiBteWJvdHBpYwogCiB9OwogCi8vIFBPUEtJRCBNRCBESUQgRVZFUllUSElORyAsLCxETyBOT1QgQ09QWSAuLi4KaWYgKCFzdXBlclVzZXIgJiYgb3JpZ2luZU1lc3NhZ2UgPT09IGF1dGV1ck1lc3NhZ2UgJiYgY29uZi5BVVRPX1JFQUNUID09PSAieWVzIikgewpjb25zdCBlbW9qaXMgPSBbJ/CfkaMnLCAn8J+Pl++4jycsICfinIjvuI8nLCAn8J+MvScsICfwn4+4JywgJ/Cfm5YnLCAn8J+NgScsICfwn5uw77iPJywgJ/CfpZQnLCAn8J+OoScsICfwn464JywgJ/CfjrwnLCAn8J+UiScsICfwn5O/JywgJ/CfqocnLCAn8J+TuScsICfwn46e77iPJywgJ/CfqpQnLCAn8J+TlCcsICfwn4+377iPJywgJ/CfkrAnLCAn8J+TpScsICfwn5ez77iPJywgJ/Cfk60nLCAn8J+WjO+4jycsICfwn5OPJywgJycsICfwn6qbJywgJ/CflKgnLCAn4puT77iP4oCN8J+SpScsICfwn5OMJywgJ/Cfl53vuI8nLCAn8J+UjScsICfwn6WBJywgJ/CflIonLCAn8J+lvicsICfwn5GiJywgJ/CfqbAnLCAn8J+RoScsICfwn5mCJywgJ/CfjoonLCAn8J+OiScsICfwn46BJywgJ+Kbke+4jycsICfwn5GLJ10KIGNvbnN0IGVtb2tpcyA9IGVtb2ppc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoZW1vamlzLmxlbmd0aCkpXQogemsuc2VuZE1lc3NhZ2Uob3JpZ2luZU1lc3NhZ2UsIHsKIHJlYWN0OiB7CiB0ZXh0OiBlbW9raXMsCiBrZXk6IG1zLmtleQogfQogfSkKfQogLy8gQVVUT19SRUFEX01FU1NBR0VTOiBBdXRvbWF0aWNhbGx5IG1hcmsgbWVzc2FnZXMgYXMgcmVhZCBpZiBlbmFibGVkLgogaWYgKGNvbmYuQVVUT19SRUFEX01FU1NBR0VTID09PSAieWVzIikgewogemsuZXYub24oIm1lc3NhZ2VzLnVwc2VydCIsIGFzeW5jIG0gPT4gewogY29uc3QgewogbWVzc2FnZXMKIH0gPSBtOwogZm9yIChjb25zdCBtZXNzYWdlIG9mIG1lc3NhZ2VzKSB7CiBpZiAoIW1lc3NhZ2Uua2V5LmZyb21NZSkgewogYXdhaXQgemsucmVhZE1lc3NhZ2VzKFttZXNzYWdlLmtleV0pOwogfQogfQogfSk7CiB9CiAvLyBIYW5kbGUgdmlld09uY2UgbWVzc2FnZXMKaWYgKG1zLm1lc3NhZ2U/LnZpZXdPbmNlTWVzc2FnZSB8fCBtcy5tZXNzYWdlPy52aWV3T25jZU1lc3NhZ2VWMiB8fCBtcy5tZXNzYWdlPy52aWV3T25jZU1lc3NhZ2VWMkV4dGVuc2lvbikgewogaWYgKGNvbmYuQU5USVZWLnRvTG93ZXJDYXNlKCkgPT09ICJ5ZXMiICYmICFtcy5rZXkuZnJvbU1lKSB7CiBjb25zdCBtZXNzYWdlQ29udGVudCA9IG1zLm1lc3NhZ2VbbXR5cGVdOwoKIC8vIENoZWNrIGlmIHRoZSBtZXNzYWdlIGlzIGFuIGltYWdlCiBpZiAobWVzc2FnZUNvbnRlbnQuaW1hZ2VNZXNzYWdlKSB7CiBjb25zdCBpbWFnZVVybCA9IGF3YWl0IHprLmRvd25sb2FkQW5kU2F2ZU1lZGlhTWVzc2FnZShtZXNzYWdlQ29udGVudC5pbWFnZU1lc3NhZ2UpOwogY29uc3QgaW1hZ2VDYXB0aW9uID0gbWVzc2FnZUNvbnRlbnQuaW1hZ2VNZXNzYWdlLmNhcHRpb247CgogY29uc3QgaW1hZ2VNZXNzYWdlID0gewogaW1hZ2U6IHsgdXJsOiBpbWFnZVVybCB9LAogY2FwdGlvbjogaW1hZ2VDYXB0aW9uCiB9OwoKIGNvbnN0IHF1b3RlZE1lc3NhZ2UgPSB7IHF1b3RlZDogbXMgfTsKIGF3YWl0IHprLnNlbmRNZXNzYWdlKGlkQm90LCBpbWFnZU1lc3NhZ2UsIHF1b3RlZE1lc3NhZ2UpOwogfSAKIC8vIENoZWNrIGlmIHRoZSBtZXNzYWdlIGlzIGEgdmlkZW8KIGVsc2UgaWYgKG1lc3NhZ2VDb250ZW50LnZpZGVvTWVzc2FnZSkgewogY29uc3QgdmlkZW9VcmwgPSBhd2FpdCB6ay5kb3dubG9hZEFuZFNhdmVNZWRpYU1lc3NhZ2UobWVzc2FnZUNvbnRlbnQudmlkZW9NZXNzYWdlKTsKIGNvbnN0IHZpZGVvQ2FwdGlvbiA9IG1lc3NhZ2VDb250ZW50LnZpZGVvTWVzc2FnZS5jYXB0aW9uOwoKIGNvbnN0IHZpZGVvTWVzc2FnZSA9IHsKIHZpZGVvOiB7IHVybDogdmlkZW9VcmwgfSwKIGNhcHRpb246IHZpZGVvQ2FwdGlvbgogfTsKCiBjb25zdCBxdW90ZWRNZXNzYWdlID0geyBxdW90ZWQ6IG1zIH07CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShpZEJvdCwgdmlkZW9NZXNzYWdlLCBxdW90ZWRNZXNzYWdlKTsKIH0gCiAvLyBDaGVjayBpZiB0aGUgbWVzc2FnZSBpcyBhdWRpbwogZWxzZSBpZiAobWVzc2FnZUNvbnRlbnQuYXVkaW9NZXNzYWdlKSB7CiBjb25zdCBhdWRpb1VybCA9IGF3YWl0IHprLmRvd25sb2FkQW5kU2F2ZU1lZGlhTWVzc2FnZShtZXNzYWdlQ29udGVudC5hdWRpb01lc3NhZ2UpOwoKIGNvbnN0IGF1ZGlvTWVzc2FnZSA9IHsKIGF1ZGlvOiB7IHVybDogYXVkaW9VcmwgfSwKIG15bWV0eXBlOiAiYXVkaW8vbXA0IgogfTsKCiBjb25zdCBxdW90ZWRNZXNzYWdlID0geyBxdW90ZWQ6IG1zLCBwdHQ6IGZhbHNlIH07CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShpZEJvdCwgYXVkaW9NZXNzYWdlLCBxdW90ZWRNZXNzYWdlKTsKIH0KIH0KfSAKIC8vIEhhbmRsZSBtZWRpYSBtZXNzYWdlcyBsaWtlIGltYWdlcywgYXVkaW8sIHZpZGVvLCBzdGlja2VycywgYW5kIGRvY3VtZW50cwppZiAobXMubWVzc2FnZT8uaW1hZ2VNZXNzYWdlIHx8IG1zLm1lc3NhZ2U/LmF1ZGlvTWVzc2FnZSB8fCBtcy5tZXNzYWdlPy52aWRlb01lc3NhZ2UgfHwgbXMubWVzc2FnZT8uc3RpY2tlck1lc3NhZ2UgfHwgbXMubWVzc2FnZT8uZG9jdW1lbnRNZXNzYWdlKSB7CiBsZXQgaXNTcGFtOwoKIC8vIENoZWNrIGlmIGFudGlzcGFtIGRhdGEgZXhpc3RzIGluIGNhY2hlCiBpZiAobXMuaGFzKCJhbnRpc3BhbSIpKSB7CiBpc1NwYW0gPSBtcy5nZXQoImFudGlzcGFtIikuaW5jbHVkZXMob3JpZ2luZU1lc3NhZ2UpOwogfSBlbHNlIHsKIGNvbnN0IGFudGlzcGFtTGlzdCA9IGF3YWl0IGFudGlzcGFtRnVuY3Rpb25zKCk7CiBpc1NwYW0gPSBhbnRpc3BhbUxpc3QuaW5jbHVkZXMob3JpZ2luZU1lc3NhZ2UpOwogbXMuc2V0KCJhbnRpc3BhbSIsIGFudGlzcGFtTGlzdCk7CiB9CgogLy8gSWYgdGhlIG1lc3NhZ2UgaXMgY29uc2lkZXJlZCBzcGFtLCBoYW5kbGUgaXQKIGlmICh2ZXJpZkdyb3VwZSAmJiBpc1NwYW0gJiYgIXN1cGVyVXNlciAmJiAhdmVyaWZBZG1pbikgewogY29uc29sZS53YXJuKCItLS0tLS0tLS0tLS0tLS0tLS1NZWRpYS0tLS0tLXNlbnQtLS0tLS0tLS0tLS0tLS0tLS0tLSIpOwoKIC8vIFJldHJpZXZlIHRoZSBsaXN0IG9mIHNwYW1tZXJzIGZvciBhIGdpdmVuIHVzZXIKIGNvbnN0IHNwYW1MaXN0ID0gc3BhbUNhY2hlLmdldChhdXRldXJNZXNzYWdlICsgJ18nICsgb3JpZ2luZU1lc3NhZ2UpOwogaWYgKHNwYW1MaXN0KSB7CiBpZiAoc3BhbUxpc3QubGVuZ3RoID49IDQpIHsKIHNwYW1MaXN0LnB1c2gobXMua2V5KTsKCiAvLyBEZWxldGUgYWxsIHNwYW0gbWVzc2FnZXMgZnJvbSB0aGUgZ3JvdXAKIHNwYW1MaXN0LmZvckVhY2goc3BhbUtleSA9PiB7CiBjb25zdCBkZWxldGVNZXNzYWdlID0geyBkZWxldGU6IHNwYW1LZXkgfTsKIHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCBkZWxldGVNZXNzYWdlKTsKIH0pOwoKIC8vIFJlbW92ZSB0aGUgdXNlciBmcm9tIHRoZSBncm91cCBhbmQgc2VuZCBhIG5vdGlmaWNhdGlvbgogemsuZ3JvdXBQYXJ0aWNpcGFudHNVcGRhdGUob3JpZ2luZU1lc3NhZ2UsIFthdXRldXJNZXNzYWdlXSwgInJlbW92ZSIpLnRoZW4oKCkgPT4gewogemsuc2VuZE1lc3NhZ2Uob3JpZ2luZU1lc3NhZ2UsIHsKIHRleHQ6ICdAJyArIGF1dGV1ck1lc3NhZ2Uuc3BsaXQoJ0AnKVswXSArICIgcmVtb3ZlZCBiZWNhdXNlIG9mIHNwYW1taW5nIGluIGdyb3VwIiwKIG1lbnRpb25zOiBbYXV0ZXVyTWVzc2FnZV0KIH0pOwogfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpOwogfSBlbHNlIHsKIC8vIEFkZCB0aGUgY3VycmVudCBtZXNzYWdlIHRvIHRoZSBzcGFtIGxpc3QKIHNwYW1MaXN0LnB1c2gobXMua2V5KTsKIHNwYW1DYWNoZS5zZXQoYXV0ZXVyTWVzc2FnZSArICdfJyArIG9yaWdpbmVNZXNzYWdlLCBzcGFtTGlzdCwgMTIwKTsgLy8gS2VlcCBmb3IgMTIwIHNlY29uZHMKIH0KIH0gZWxzZSB7CiAvLyBJZiBubyBzcGFtIGxpc3QgZXhpc3RzLCBjcmVhdGUgYSBuZXcgb25lCiBzcGFtQ2FjaGUuc2V0KGF1dGV1ck1lc3NhZ2UgKyAnXycgKyBvcmlnaW5lTWVzc2FnZSwgW21zLmtleV0pOwogfQogfQp9CgogLy8gQU5USUxJTksgZmVhdHVyZTogRGV0ZWN0IGdyb3VwIGxpbmtzIGFuZCB0YWtlIGFjdGlvbnMKaWYgKGNvbmYuQU5USUxJTksgPT09ICJ5ZXMiKSB7CiB6ay5ldi5vbigibWVzc2FnZXMudXBzZXJ0IiwgYXN5bmMgKG0pID0+IHsKIGNvbnN0IHsgbWVzc2FnZXMgfSA9IG07CiBjb25zdCBtcyA9IG1lc3NhZ2VzWzBdOwogaWYgKCFtcy5tZXNzYWdlKSB7CiByZXR1cm47CiB9CgogLy8gRXh0cmFjdCBtZXNzYWdlIGNvbnRlbnQKIGNvbnN0IHRleHRlID0gbXMubWVzc2FnZS5jb252ZXJzYXRpb24gfHwgbXMubWVzc2FnZS5leHRlbmRlZFRleHRNZXNzYWdlPy50ZXh0IHx8ICIiOwogY29uc3QgbWVzc2FnZUtleSA9IG1zLmtleTsKIGNvbnN0IHJlbW90ZUppZCA9IG1lc3NhZ2VLZXkucmVtb3RlSmlkOwoKIC8vIEVuc3VyZSB0aGVyZSBpcyBhIGNoYXQgaGlzdG9yeSB0byBzdG9yZSB0aGUgbWVzc2FnZQogaWYgKCFzdG9yZS5jaGF0c1tyZW1vdGVKaWRdKSB7CiBzdG9yZS5jaGF0c1tyZW1vdGVKaWRdID0gW107CiB9CiBzdG9yZS5jaGF0c1tyZW1vdGVKaWRdLnB1c2gobXMpOwoKIC8vIENoZWNrIGlmIHRoZSBtZXNzYWdlIGNvbnRhaW5zIGEgV2hhdHNBcHAgZ3JvdXAgbGluawogaWYgKHRleHRlLmluY2x1ZGVzKCJjaGF0LndoYXRzYXBwLmNvbSIpICYmICFjb25mLnN1cGVyVXNlci5pbmNsdWRlcyhtcy5rZXkucGFydGljaXBhbnQpICYmCiBjb25mLnZlcmlmQWRtaW4gJiYgIWNvbmYuZ3JvdXBlQWRtaW4uaW5jbHVkZXMobXMua2V5LnBhcnRpY2lwYW50KSAmJiBtcy5rZXkucmVtb3RlSmlkLmluY2x1ZGVzKCJAZy51cyIpKSB7CgogLy8gUmVzcG9uZCB0byB0aGUgbWVzc2FnZQogcmVwb25kcmUoIl9Hcm91cCBsaW5rIGRldGVjdGVkXyIpOwoKIGNvbnN0IHBhcnRpY2lwYW50ID0gbXMua2V5LnBhcnRpY2lwYW50IHx8IG1zLmtleS5yZW1vdGVKaWQ7CiBjb25zdCBjaGF0SWQgPSBtcy5rZXkucmVtb3RlSmlkOwoKIC8vIERlbGV0ZSB0aGUgbWVzc2FnZSB3aXRoIHRoZSBncm91cCBsaW5rCiBhd2FpdCB6ay5zZW5kTWVzc2FnZShjaGF0SWQsIHsKIGRlbGV0ZTogewogcmVtb3RlSmlkOiBjaGF0SWQsCiBmcm9tTWU6IGZhbHNlLAogaWQ6IG1zLmtleS5pZCwKIHBhcnRpY2lwYW50OiBwYXJ0aWNpcGFudCwKIH0KIH0pOwoKIC8vIFJlbW92ZSB0aGUgcGFydGljaXBhbnQgd2hvIHNlbnQgdGhlIGxpbmsKIGF3YWl0IHprLmdyb3VwUGFydGljaXBhbnRzVXBkYXRlKGNoYXRJZCwgW3BhcnRpY2lwYW50XSwgJ3JlbW92ZScpOwoKIC8vIE5vdGlmeSB0aGUgZ3JvdXAgYWJvdXQgdGhlIHBhcnRpY2lwYW50IHJlbW92YWwKIGF3YWl0IHprLnNlbmRNZXNzYWdlKGNoYXRJZCwgewogdGV4dDogYFJlbW92ZWQhXG5cbkAke3BhcnRpY2lwYW50LnNwbGl0KCJAIilbMF19IHNlbmRpbmcgZ3JvdXAgbGlua3MgaXMgcHJvaGliaXRlZCFgLAogY29udGV4dEluZm86IHsKIG1lbnRpb25lZEppZDogW3BhcnRpY2lwYW50XQogfQogfSwgewogcXVvdGVkOiBtcwogfSk7CiB9CiB9KTsKIH0KCgogLyoqKioqKioqKioqKioqKioqKioqKioqKiBhbnRpLWRlbGV0ZS1tZXNzYWdlICovCgogaWYobXMubWVzc2FnZS5wcm90b2NvbE1lc3NhZ2UgJiYgbXMubWVzc2FnZS5wcm90b2NvbE1lc3NhZ2UudHlwZSA9PT0gMCAmJiAoY29uZi5BRE0pLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09ICd5ZXMnICkgewoKIGlmKG1zLmtleS5mcm9tTWUgfHwgbXMubWVzc2FnZS5wcm90b2NvbE1lc3NhZ2Uua2V5LmZyb21NZSkgeyBjb25zb2xlLmxvZygnTWVzc2FnZSBkZWxldGUgYWJvdXQgbWUnKSA7IHJldHVybiB9CiAKIGNvbnNvbGUubG9nKGBNZXNzYWdlIGRlbGV0ZWRgKQogbGV0IGtleSA9IG1zLm1lc3NhZ2UucHJvdG9jb2xNZXNzYWdlLmtleSA7CiAKIAogdHJ5IHsKIAogbGV0IHN0ID0gJy4vc3RvcmUuanNvbicgOwogCiBjb25zdCBkYXRhID0gZnMucmVhZEZpbGVTeW5jKHN0LCAndXRmOCcpOwogCiBjb25zdCBqc29uRGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAKIGxldCBtZXNzYWdlID0ganNvbkRhdGEubWVzc2FnZXNba2V5LnJlbW90ZUppZF0gOwogCiBsZXQgbXNnIDsKIAogZm9yIChsZXQgaSA9IDAgOyBpIDwgbWVzc2FnZS5sZW5ndGggOyBpKyspIHsKIAogaWYgKG1lc3NhZ2VbaV0ua2V5LmlkID09PSBrZXkuaWQpIHsKIAogbXNnID0gbWVzc2FnZVtpXSA7CiAKIGJyZWFrIAogfQogCiB9IAogCiAvLyBjb25zb2xlLmxvZyhtc2cpCiAKIGlmKG1zZyA9PT0gbnVsbCB8fCAhbXNnIHx8bXNnID09PSAndW5kZWZpbmVkJykge2NvbnNvbGUubG9nKCdNZXNzYWdlIG5vdCBmb3VuZCcpIDsgcmV0dXJuIH0gCiAKIGF3YWl0IHprLnNlbmRNZXNzYWdlKGlkQm90LHsgaW1hZ2UgOiB7IHVybCA6ICcuL21lZGlhL2RlbGV0ZWQtbWVzc2FnZS5qcGcnfSxjYXB0aW9uIDogYCDwnZCC8J2QgPCdkJLwnZCE8J2QmPCdkJHwnZCH8J2QjvCdkIPwnZCE8J2Qki3wnZCM8J2QgyDwnZCD8J2QhPCdkIvwnZCE8J2Qk/CdkITwnZCDIPCdkIjwnZCN8J2QhfCdkI7wnZCR8J2QjPCdkIDwnZCT8J2QiPCdkI7wnZCNIFxuIE1lc3NhZ2UgZnJvbSBAJHttc2cua2V5LnBhcnRpY2lwYW50LnNwbGl0KCdAJylbMF194oCLXG4g8J2Qk/CdkIfwnZCEIPCdkIPwnZCE8J2Qi/CdkITwnZCT8J2QhPCdkIMg8J2QjPCdkITwnZCS8J2QkvCdkIDwnZCG8J2QhCDwnZCI8J2QkiDwnZCH8J2QhPCdkJHwnZCEIPCfkYdgICwgbWVudGlvbnMgOiBbbXNnLmtleS5wYXJ0aWNpcGFudF19LCkKIC50aGVuKCAoKSA9PiB7CiB6ay5zZW5kTWVzc2FnZShpZEJvdCx7Zm9yd2FyZCA6IG1zZ30se3F1b3RlZCA6IG1zZ30pIDsKIH0pCiAKIAogCiB9IGNhdGNoIChlKSB7CiBjb25zb2xlLmxvZyhlKQogfQogfQogCiAvKiogKioqKioqIGdlc3Rpb24gYXV0by1zdGF0dXMgKi8KIGlmIChtcy5rZXkgJiYgbXMua2V5LnJlbW90ZUppZCA9PT0gInN0YXR1c0Bicm9hZGNhc3QiICYmIGNvbmYuQVVUT19SRUFEX1NUQVRVUyA9PT0gInllcyIpIHsKIGF3YWl0IHprLnJlYWRNZXNzYWdlcyhbbXMua2V5XSk7CiB9CiAKIGlmIChtcy5rZXkgJiYgbXMua2V5LnJlbW90ZUppZCA9PT0gJ3N0YXR1c0Bicm9hZGNhc3QnICYmIGNvbmYuQVVUT19ET1dOTE9BRF9TVEFUVVMgPT09ICJ5ZXMiKSB7CiAvKiBhd2FpdCB6ay5yZWFkTWVzc2FnZXMoW21zLmtleV0pOyovCiBpZiAobXMubWVzc2FnZS5leHRlbmRlZFRleHRNZXNzYWdlKSB7CiB2YXIgc3RUeHQgPSBtcy5tZXNzYWdlLmV4dGVuZGVkVGV4dE1lc3NhZ2UudGV4dDsKIGF3YWl0IHprLnNlbmRNZXNzYWdlKGlkQm90LCB7IHRleHQ6IHN0VHh0IH0sIHsgcXVvdGVkOiBtcyB9KTsKIH0KIGVsc2UgaWYgKG1zLm1lc3NhZ2UuaW1hZ2VNZXNzYWdlKSB7CiB2YXIgc3RNc2cgPSBtcy5tZXNzYWdlLmltYWdlTWVzc2FnZS5jYXB0aW9uOwogdmFyIHN0SW1nID0gYXdhaXQgemsuZG93bmxvYWRBbmRTYXZlTWVkaWFNZXNzYWdlKG1zLm1lc3NhZ2UuaW1hZ2VNZXNzYWdlKTsKIGF3YWl0IHprLnNlbmRNZXNzYWdlKGlkQm90LCB7IGltYWdlOiB7IHVybDogc3RJbWcgfSwgY2FwdGlvbjogc3RNc2cgfSwgeyBxdW90ZWQ6IG1zIH0pOwogfQogZWxzZSBpZiAobXMubWVzc2FnZS52aWRlb01lc3NhZ2UpIHsKIHZhciBzdE1zZyA9IG1zLm1lc3NhZ2UudmlkZW9NZXNzYWdlLmNhcHRpb247CiB2YXIgc3RWaWRlbyA9IGF3YWl0IHprLmRvd25sb2FkQW5kU2F2ZU1lZGlhTWVzc2FnZShtcy5tZXNzYWdlLnZpZGVvTWVzc2FnZSk7CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShpZEJvdCwgewogdmlkZW86IHsgdXJsOiBzdFZpZGVvIH0sIGNhcHRpb246IHN0TXNnCiB9LCB7IHF1b3RlZDogbXMgfSk7CiB9CiAvKiogKioqKioqKioqKioqKioqICovCiAvLyBjb25zb2xlLmxvZygiKm5vdXZlYXUgc3RhdHVzKiAiKTsKIH0KIC8qKiAqKioqKipmaW4gYXV0by1zdGF0dXMgKi8KIGlmICghZGV2ICYmIG9yaWdpbmVNZXNzYWdlID09ICIxMjAzNjMxNTg3MDEzMzc5MDRAZy51cyIpIHsKIHJldHVybjsKIH0KIAogLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1yYW5nLWNvdW50LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGlmICh0ZXh0ZSAmJiBhdXRldXJNZXNzYWdlLmVuZHNXaXRoKCJzLndoYXRzYXBwLm5ldCIpKSB7CiBjb25zdCB7IGFqb3V0ZXJPdU1ldHRyZUFKb3VyVXNlckRhdGEgfSA9IHJlcXVpcmUoIi4vYmRkL2xldmVsIik7IAogdHJ5IHsKIGF3YWl0IGFqb3V0ZXJPdU1ldHRyZUFKb3VyVXNlckRhdGEoYXV0ZXVyTWVzc2FnZSk7CiB9IGNhdGNoIChlKSB7CiBjb25zb2xlLmVycm9yKGUpOwogfQogfQogCiAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBNZW50aW9ucyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogCiB0cnkgewogCiBpZiAobXMubWVzc2FnZVttdHlwZV0uY29udGV4dEluZm8ubWVudGlvbmVkSmlkICYmIChtcy5tZXNzYWdlW210eXBlXS5jb250ZXh0SW5mby5tZW50aW9uZWRKaWQuaW5jbHVkZXMoaWRCb3QpIHx8IG1zLm1lc3NhZ2VbbXR5cGVdLmNvbnRleHRJbmZvLm1lbnRpb25lZEppZC5pbmNsdWRlcyhjb25mLk5VTUVST19PV05FUiArICdAcy53aGF0c2FwcC5uZXQnKSkgLyp0ZXh0ZS5pbmNsdWRlcyhpZEJvdC5zcGxpdCgnQCcpWzBdKSB8fCB0ZXh0ZS5pbmNsdWRlcyhjb25mLk5VTUVST19PV05FUikqLykgewogCiBpZiAob3JpZ2luZU1lc3NhZ2UgPT0gIjEyMDM2MzE1ODcwMTMzNzkwNEBnLnVzIikgewogcmV0dXJuOwogfSA7CiAKIGlmKHN1cGVyVXNlcikge2NvbnNvbGUubG9nKCdodW1tbScpIDsgcmV0dXJuIDt9IAogCiBsZXQgbWJkID0gcmVxdWlyZSgnLi9iZGQvbWVudGlvbicpIDsKIAogbGV0IGFsbGRhdGEgPSBhd2FpdCBtYmQucmVjdXBlcmVyVG91dGVzTGVzVmFsZXVycygpIDsKIAogbGV0IGRhdGEgPSBhbGxkYXRhWzBdIDsKIAogaWYgKCBkYXRhLnN0YXR1cyA9PT0gJ25vbicpIHsgY29uc29sZS5sb2coJ21lbnRpb24gcGFzIGFjdGlmcycpIDsgcmV0dXJuIDt9CiAKIGxldCBtc2cgOwogCiBpZiAoZGF0YS50eXBlLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09ICdpbWFnZScpIHsKIAogbXNnID0gewogaW1hZ2UgOiB7IHVybCA6IGRhdGEudXJsfSwKIGNhcHRpb24gOiBkYXRhLm1lc3NhZ2UKIH0KIH0gZWxzZSBpZiAoZGF0YS50eXBlLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09ICd2aWRlbycgKSB7CiAKIG1zZyA9IHsKIHZpZGVvIDogeyB1cmwgOiBkYXRhLnVybH0sCiBjYXB0aW9uIDogZGF0YS5tZXNzYWdlCiB9CiAKIH0gZWxzZSBpZiAoZGF0YS50eXBlLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09ICdzdGlja2VyJykgewogCiBsZXQgc3RpY2tlck1lc3MgPSBuZXcgU3RpY2tlcihkYXRhLnVybCwgewogcGFjazogY29uZi5OT01fT1dORVIsCiB0eXBlOiBTdGlja2VyVHlwZXMuRlVMTCwKIGNhdGVnb3JpZXM6IFsi8J+kqSIsICLwn46JIl0sCiBpZDogIjEyMzQ1IiwKIHF1YWxpdHk6IDcwLAogYmFja2dyb3VuZDogInRyYW5zcGFyZW50IiwKIH0pOwogCiBjb25zdCBzdGlja2VyQnVmZmVyMiA9IGF3YWl0IHN0aWNrZXJNZXNzLnRvQnVmZmVyKCk7CiAKIG1zZyA9IHsKIHN0aWNrZXIgOiBzdGlja2VyQnVmZmVyMiAKIH0KIAogfSBlbHNlIGlmIChkYXRhLnR5cGUudG9Mb2NhbGVMb3dlckNhc2UoKSA9PT0gJ2F1ZGlvJyApIHsKIAogbXNnID0gewogCiBhdWRpbyA6IHsgdXJsIDogZGF0YS51cmwgfSAsCiBtaW1ldHlwZTonYXVkaW8vbXA0JywKIH0KIAogfQogCiB6ay5zZW5kTWVzc2FnZShvcmlnaW5lTWVzc2FnZSxtc2cse3F1b3RlZCA6IG1zfSkKIAogfQogfSBjYXRjaCAoZXJyb3IpIHsKIAogfSAKCgogLy9hbnRpLWxpZW4KIHRyeSB7CiBjb25zdCB5ZXMgPSBhd2FpdCB2ZXJpZmllckV0YXRKaWQob3JpZ2luZU1lc3NhZ2UpCiBpZiAodGV4dGUuaW5jbHVkZXMoJ2h0dHBzOi8vJykgJiYgdmVyaWZHcm91cGUgJiYgeWVzICkgewoKIGNvbnNvbGUubG9nKCJsaW5rIGRldGVjdGVkIikKIHZhciB2ZXJpZlpva0FkbWluID0gdmVyaWZHcm91cGUgPyBhZG1pbnMuaW5jbHVkZXMoaWRCb3QpIDogZmFsc2U7CiAKIGlmKHN1cGVyVXNlciB8fCB2ZXJpZkFkbWluIHx8ICF2ZXJpZlpva0FkbWluICkgeyBjb25zb2xlLmxvZygnSSBkbyBub3RoaW5nJyk7IHJldHVybn07CiAKIGNvbnN0IGtleSA9IHsKIHJlbW90ZUppZDogb3JpZ2luZU1lc3NhZ2UsCiBmcm9tTWU6IGZhbHNlLAogaWQ6IG1zLmtleS5pZCwKIHBhcnRpY2lwYW50OiBhdXRldXJNZXNzYWdlCiB9OwogdmFyIHR4dCA9ICJsaW5rIGRldGVjdGVkISFcbiI7CiAvLyB0eHQgKz0gYG1lc3NhZ2Ugc3VwcHJpbcOpIFxuIEAke2F1dGV1ck1lc3NhZ2Uuc3BsaXQoIkAiKVswXX0gcsOpdGlyw6kgZHUgZ3JvdXBlLmA7CiBjb25zdCBnaWZMaW5rID0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9kamFsZWdhODAwMC9ab2tvdS1NRC9tYWluL21lZGlhL3JlbW92ZXIuZ2lmIjsKIHZhciBzdGlja2VyID0gbmV3IFN0aWNrZXIoZ2lmTGluaywgewogcGFjazogJ0NBU0VZUkhPREVTLU1EJywKIGF1dGhvcjogY29uZi5PV05FUl9OQU1FLAogdHlwZTogU3RpY2tlclR5cGVzLkZVTEwsCiBjYXRlZ29yaWVzOiBbJ/CfpKknLCAn8J+OiSddLAogaWQ6ICcxMjM0NScsCiBxdWFsaXR5OiA1MCwKIGJhY2tncm91bmQ6ICcjMDAwMDAwJwogfSk7CiBhd2FpdCBzdGlja2VyLnRvRmlsZSgic3QxLndlYnAiKTsKIC8vIHZhciB0eHQgPSBgQCR7YXV0ZXVyTXNnUmVwb25kdS5zcGxpdCgiQCIpWzBdfSBhIMOpdMOpIHLDqXRpcsOpIGR1IGdyb3VwZS4uXG5gCiB2YXIgYWN0aW9uID0gYXdhaXQgcmVjdXBlcmVyQWN0aW9uSmlkKG9yaWdpbmVNZXNzYWdlKTsKCiBpZiAoYWN0aW9uID09PSAncmVtb3ZlJykgewoKIHR4dCArPSBgbWVzc2FnZSBkZWxldGVkIFxuIEAke2F1dGV1ck1lc3NhZ2Uuc3BsaXQoIkAiKVswXX0gyoDhtIfhtI3htI/htKDhtIfhtIUg0pPKgOG0j+G0jSDJosqA4bSP4bSc4bSYIMqZyo8g4bSE4bSAc+G0h8qPyoDKnOG0j+G0heG0h3Mg4bSN4bSFLmA7CgogYXdhaXQgemsuc2VuZE1lc3NhZ2Uob3JpZ2luZU1lc3NhZ2UsIHsgc3RpY2tlcjogZnMucmVhZEZpbGVTeW5jKCJzdDEud2VicCIpIH0pOwogKDAsIGJhaWxleXNfMS5kZWxheSkoODAwKTsKIGF3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IHRleHQ6IHR4dCwgbWVudGlvbnM6IFthdXRldXJNZXNzYWdlXSB9LCB7IHF1b3RlZDogbXMgfSk7CiB0cnkgewogYXdhaXQgemsuZ3JvdXBQYXJ0aWNpcGFudHNVcGRhdGUob3JpZ2luZU1lc3NhZ2UsIFthdXRldXJNZXNzYWdlXSwgInJlbW92ZSIpOwogfQogY2F0Y2ggKGUpIHsKIGNvbnNvbGUubG9nKCJhbnRpaWVuICIpICsgZTsKIH0KIGF3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IGRlbGV0ZToga2V5IH0pOwogYXdhaXQgZnMudW5saW5rKCJzdDEud2VicCIpOyB9IAogCiBlbHNlIGlmIChhY3Rpb24gPT09ICdkZWxldGUnKSB7CiB0eHQgKz0gYOG0jeG0h3Nz4bSAyaLhtIcg4bSF4bSHyp/htIfhtJvhtIfhtIUgXG4gQCR7YXV0ZXVyTWVzc2FnZS5zcGxpdCgiQCIpWzBdfSDhtIDhtKDhtI/JquG0hSBz4bSHybThtIXJqsm0yaIgyp/Jqsm04bSLcyDhtJvhtI8g4bSbypzhtIcgyaLKgOG0j+G0nOG0mC5gOwogLy8gYXdhaXQgemsuc2VuZE1lc3NhZ2Uob3JpZ2luZU1lc3NhZ2UsIHsgc3RpY2tlcjogZnMucmVhZEZpbGVTeW5jKCJzdDEud2VicCIpIH0sIHsgcXVvdGVkOiBtcyB9KTsKIGF3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IHRleHQ6IHR4dCwgbWVudGlvbnM6IFthdXRldXJNZXNzYWdlXSB9LCB7IHF1b3RlZDogbXMgfSk7CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShvcmlnaW5lTWVzc2FnZSwgeyBkZWxldGU6IGtleSB9KTsKIGF3YWl0IGZzLnVubGluaygic3QxLndlYnAiKTsKCiB9IGVsc2UgaWYoYWN0aW9uID09PSAnd2FybicpIHsKIGNvbnN0IHtnZXRXYXJuQ291bnRCeUpJRCAsYWpvdXRlclV0aWxpc2F0ZXVyQXZlY1dhcm5Db3VudH0gPSByZXF1aXJlKCcuL2JkZC93YXJuJykgOwoKIGxldCB3YXJuID0gYXdhaXQgZ2V0V2FybkNvdW50QnlKSUQoYXV0ZXVyTWVzc2FnZSkgOyAKIGxldCB3YXJubGltaXQgPSBjb25mLldBUk5fQ09VTlQKIGlmICggd2FybiA+PSB3YXJubGltaXQpIHsgCiB2YXIga2lrbXNnID0gYGxpbmsgZGV0ZWN0ZWQgLCB5b3Ugd2lsbCBiZSByZW1vdmUgYmVjYXVzZSBvZiByZWFjaGluZyB3YXJuLWxpbWl0YDsKIAogYXdhaXQgemsuc2VuZE1lc3NhZ2Uob3JpZ2luZU1lc3NhZ2UsIHsgdGV4dDoga2lrbXNnICwgbWVudGlvbnM6IFthdXRldXJNZXNzYWdlXSB9LCB7IHF1b3RlZDogbXMgfSkgOwoKCiBhd2FpdCB6ay5ncm91cFBhcnRpY2lwYW50c1VwZGF0ZShvcmlnaW5lTWVzc2FnZSwgW2F1dGV1ck1lc3NhZ2VdLCAicmVtb3ZlIik7CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShvcmlnaW5lTWVzc2FnZSwgeyBkZWxldGU6IGtleSB9KTsKCgogfSBlbHNlIHsKIHZhciByZXN0ID0gd2FybmxpbWl0IC0gd2FybiA7CiB2YXIgbXNnID0gYExpbmsgZGV0ZWN0ZWQgLCB5b3VyIHdhcm5fY291bnQgd2FzIHVwZ3JhZGUgO1xuIHJlc3QgOiAke3Jlc3R9IGA7CgogYXdhaXQgYWpvdXRlclV0aWxpc2F0ZXVyQXZlY1dhcm5Db3VudChhdXRldXJNZXNzYWdlKQoKIGF3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IHRleHQ6IG1zZyAsIG1lbnRpb25zOiBbYXV0ZXVyTWVzc2FnZV0gfSwgeyBxdW90ZWQ6IG1zIH0pIDsKIGF3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IGRlbGV0ZToga2V5IH0pOwoKIH0KIH0KIH0KIAogfQogCiAKIAogCiAKIAogY2F0Y2ggKGUpIHsKIGNvbnNvbGUubG9nKCJiZGQgZXJyICIgKyBlKTsKIH0KIAoKCiAvKiogKioqKioqKioqKioqKioqKioqKioqKioqKmFudGktYm90KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8KIHRyeSB7CiBjb25zdCBib3RNc2cgPSBtcy5rZXk/LmlkPy5zdGFydHNXaXRoKCdCQUVTJykgJiYgbXMua2V5Py5pZD8ubGVuZ3RoID09PSAxNjsKIGNvbnN0IGJhaWxleXNNc2cgPSBtcy5rZXk/LmlkPy5zdGFydHNXaXRoKCdCQUU1JykgJiYgbXMua2V5Py5pZD8ubGVuZ3RoID09PSAxNjsKIGlmIChib3RNc2cgfHwgYmFpbGV5c01zZykgewoKIGlmIChtdHlwZSA9PT0gJ3JlYWN0aW9uTWVzc2FnZScpIHsgY29uc29sZS5sb2coJ0kgZG8gbm90IHJlYWN0IHRvIHJlYWN0aW9ucycpIDsgcmV0dXJufSA7CiBjb25zdCBhbnRpYm90YWN0aXZlciA9IGF3YWl0IGF0YnZlcmlmaWVyRXRhdEppZChvcmlnaW5lTWVzc2FnZSk7CiBpZighYW50aWJvdGFjdGl2ZXIpIHtyZXR1cm59OwoKIGlmKCB2ZXJpZkFkbWluIHx8IGF1dGV1ck1lc3NhZ2UgPT09IGlkQm90ICkgeyBjb25zb2xlLmxvZygnSSBkbyBub3RoaW5nJyk7IHJldHVybn07CiAKIGNvbnN0IGtleSA9IHsKIHJlbW90ZUppZDogb3JpZ2luZU1lc3NhZ2UsCiBmcm9tTWU6IGZhbHNlLAogaWQ6IG1zLmtleS5pZCwKIHBhcnRpY2lwYW50OiBhdXRldXJNZXNzYWdlCiB9OwogdmFyIHR4dCA9ICJib3QgZGV0ZWN0ZWQsIFxuIjsKIC8vIHR4dCArPSBgbWVzc2FnZSBzdXBwcmltw6kgXG4gQCR7YXV0ZXVyTWVzc2FnZS5zcGxpdCgiQCIpWzBdfSByw6l0aXLDqSBkdSBncm91cGUuYDsKIGNvbnN0IGdpZkxpbmsgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2RqYWxlZ2E4MDAwL1pva291LU1EL21haW4vbWVkaWEvcmVtb3Zlci5naWYiOwogdmFyIHN0aWNrZXIgPSBuZXcgU3RpY2tlcihnaWZMaW5rLCB7CiBwYWNrOiAnQmVsdGFoLU1kJywKIGF1dGhvcjogY29uZi5PV05FUl9OQU1FLAogdHlwZTogU3RpY2tlclR5cGVzLkZVTEwsCiBjYXRlZ29yaWVzOiBbJ/CfpKknLCAn8J+OiSddLAogaWQ6ICcxMjM0NScsCiBxdWFsaXR5OiA1MCwKIGJhY2tncm91bmQ6ICcjMDAwMDAwJwogfSk7CiBhd2FpdCBzdGlja2VyLnRvRmlsZSgic3QxLndlYnAiKTsKIC8vIHZhciB0eHQgPSBgQCR7YXV0ZXVyTXNnUmVwb25kdS5zcGxpdCgiQCIpWzBdfSBhIMOpdMOpIHLDqXRpcsOpIGR1IGdyb3VwZS4uXG5gCiB2YXIgYWN0aW9uID0gYXdhaXQgYXRicmVjdXBlcmVyQWN0aW9uSmlkKG9yaWdpbmVNZXNzYWdlKTsKCiBpZiAoYWN0aW9uID09PSAncmVtb3ZlJykgewoKIHR4dCArPSBgbWVzc2FnZSBkZWxldGVkIFxuIEAke2F1dGV1ck1lc3NhZ2Uuc3BsaXQoIkAiKVswXX0gcmVtb3ZlZCBmcm9tIGdyb3VwLmA7CgogYXdhaXQgemsuc2VuZE1lc3NhZ2Uob3JpZ2luZU1lc3NhZ2UsIHsgc3RpY2tlcjogZnMucmVhZEZpbGVTeW5jKCJzdDEud2VicCIpIH0pOwogKDAsIGJhaWxleXNfMS5kZWxheSkoODAwKTsKIGF3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IHRleHQ6IHR4dCwgbWVudGlvbnM6IFthdXRldXJNZXNzYWdlXSB9LCB7IHF1b3RlZDogbXMgfSk7CiB0cnkgewogYXdhaXQgemsuZ3JvdXBQYXJ0aWNpcGFudHNVcGRhdGUob3JpZ2luZU1lc3NhZ2UsIFthdXRldXJNZXNzYWdlXSwgInJlbW92ZSIpOwogfQogY2F0Y2ggKGUpIHsKIGNvbnNvbGUubG9nKCJhbnRpYm90ICIpICsgZTsKIH0KIGF3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IGRlbGV0ZToga2V5IH0pOwogYXdhaXQgZnMudW5saW5rKCJzdDEud2VicCIpOyB9IAogCiBlbHNlIGlmIChhY3Rpb24gPT09ICdkZWxldGUnKSB7CiB0eHQgKz0gYG1lc3NhZ2UgZGVsZXRlIFxuIEAke2F1dGV1ck1lc3NhZ2Uuc3BsaXQoIkAiKVswXX0gQXZvaWQgc2VuZGluZyBsaW5rLmA7CiAvL2F3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IHN0aWNrZXI6IGZzLnJlYWRGaWxlU3luYygic3QxLndlYnAiKSB9LCB7IHF1b3RlZDogbXMgfSk7CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShvcmlnaW5lTWVzc2FnZSwgeyB0ZXh0OiB0eHQsIG1lbnRpb25zOiBbYXV0ZXVyTWVzc2FnZV0gfSwgeyBxdW90ZWQ6IG1zIH0pOwogYXdhaXQgemsuc2VuZE1lc3NhZ2Uob3JpZ2luZU1lc3NhZ2UsIHsgZGVsZXRlOiBrZXkgfSk7CiBhd2FpdCBmcy51bmxpbmsoInN0MS53ZWJwIik7CgogfSBlbHNlIGlmKGFjdGlvbiA9PT0gJ3dhcm4nKSB7CiBjb25zdCB7Z2V0V2FybkNvdW50QnlKSUQgLGFqb3V0ZXJVdGlsaXNhdGV1ckF2ZWNXYXJuQ291bnR9ID0gcmVxdWlyZSgnLi9iZGQvd2FybicpIDsKCiBsZXQgd2FybiA9IGF3YWl0IGdldFdhcm5Db3VudEJ5SklEKGF1dGV1ck1lc3NhZ2UpIDsgCiBsZXQgd2FybmxpbWl0ID0gY29uZi5XQVJOX0NPVU5UCiBpZiAoIHdhcm4gPj0gd2FybmxpbWl0KSB7IAogdmFyIGtpa21zZyA9IGBib3QgZGV0ZWN0ZWQgO3lvdSB3aWxsIGJlIHJlbW92ZSBiZWNhdXNlIG9mIHJlYWNoaW5nIHdhcm4tbGltaXRgOwogCiBhd2FpdCB6ay5zZW5kTWVzc2FnZShvcmlnaW5lTWVzc2FnZSwgeyB0ZXh0OiBraWttc2cgLCBtZW50aW9uczogW2F1dGV1ck1lc3NhZ2VdIH0sIHsgcXVvdGVkOiBtcyB9KSA7CgoKIGF3YWl0IHprLmdyb3VwUGFydGljaXBhbnRzVXBkYXRlKG9yaWdpbmVNZXNzYWdlLCBbYXV0ZXVyTWVzc2FnZV0sICJyZW1vdmUiKTsKIGF3YWl0IHprLnNlbmRNZXNzYWdlKG9yaWdpbmVNZXNzYWdlLCB7IGRlbGV0ZToga2V5IH0pOwoKCiB9IGVsc2UgewogdmFyIHJlc3QgPSB3YXJubGltaXQgLSB3YXJuIDsKIHZhciBtc2cgPSBgYm90IGRldGVjdGVkICwgeW91ciB3YXJuX2NvdW50IHdhcyB1cGdyYWRlIDtcbiByZXN0IDogJHtyZXN0fSBgOwoKIGF3YWl0IGFqb3V0ZXJVdGlsaXNhdGV1ckF2ZWNXYXJuQ291bnQoYXV0ZXVyTWVzc2FnZSkKCiBhd2FpdCB6ay5zZW5kTWVzc2FnZShvcmlnaW5lTWVzc2FnZSwgeyB0ZXh0OiBtc2cgLCBtZW50aW9uczogW2F1dGV1ck1lc3NhZ2VdIH0sIHsgcXVvdGVkOiBtcyB9KSA7CiBhd2FpdCB6ay5zZW5kTWVzc2FnZShvcmlnaW5lTWVzc2FnZSwgeyBkZWxldGU6IGtleSB9KTsKCiB9CiB9CiB9CiB9CiBjYXRjaCAoZXIpIHsKIGNvbnNvbGUubG9nKCcuLi4uICcgKyBlcik7CiB9IAogCiAKIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KIAogLy9leGVjdXRpb24gZGVzIGNvbW1hbmRlcyAKIGlmICh2ZXJpZkNvbSkgewogLy9hd2FpdCBhd2FpdCB6ay5yZWFkTWVzc2FnZXMobXMua2V5KTsKIGNvbnN0IGNkID0gZXZ0LmNtLmZpbmQoKHpva291KSA9PiB6b2tvdS5ub21Db20gPT09IChjb20pKTsKIGlmIChjZCkgewogdHJ5IHsKCiBpZiAoKGNvbmYuTU9ERSkudG9Mb2NhbGVMb3dlckNhc2UoKSAhPSAneWVzJyAmJiAhc3VwZXJVc2VyKSB7CiByZXR1cm47CiB9CgogLyoqKioqKioqKioqKioqKioqKiogUE1fUEVSTVQqKioqKioqKioqKioqKiovCgogaWYgKCFzdXBlclVzZXIgJiYgb3JpZ2luZU1lc3NhZ2UgPT09IGF1dGV1ck1lc3NhZ2UmJiBjb25mLlBNX1BFUk1JVCA9PT0gInllcyIgKSB7CiByZXBvbmRyZSgiQWNjZXNzIERlbmllZCEhIS4iKSA7IHJldHVybiB9CiAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogCiAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKipiYW5Hcm91cCAqLwogaWYgKCFzdXBlclVzZXIgJiYgdmVyaWZHcm91cGUpIHsKCiBsZXQgcmVxID0gYXdhaXQgaXNHcm91cEJhbm5lZChvcmlnaW5lTWVzc2FnZSk7CiAKIGlmIChyZXEpIHsgcmV0dXJuIH0KIH0KCiAvKioqKioqKioqKioqKioqKioqKioqKioqKioqIE9OTFktQURNSU4gKi8KCiBpZighdmVyaWZBZG1pbiAmJiB2ZXJpZkdyb3VwZSkgewogbGV0IHJlcSA9IGF3YWl0IGlzR3JvdXBPbmx5QWRtaW4ob3JpZ2luZU1lc3NhZ2UpOwogCiBpZiAocmVxKSB7IHJldHVybiB9fQoKIC8qKioqKioqKioqKioqKioqKioqKioqYmFudXNlciAqLwogCiAKIGlmKCFzdXBlclVzZXIpIHsKIGxldCByZXEgPSBhd2FpdCBpc1VzZXJCYW5uZWQoYXV0ZXVyTWVzc2FnZSk7CiAKIGlmIChyZXEpIHtyZXBvbmRyZSgiWW91IGFyZSBiYW5uZWQgZnJvbSBib3QgY29tbWFuZHMiKTsgcmV0dXJufQogCgogfSAKCiByZWFnaXIob3JpZ2luZU1lc3NhZ2UsIHprLCBtcywgY2QucmVhY3Rpb24pOwogY2QuZm9uY3Rpb24ob3JpZ2luZU1lc3NhZ2UsIHprLCBjb21tYW5kZU9wdGlvbnMpOwogfQogY2F0Y2ggKGUpIHsKIGNvbnNvbGUubG9nKCLwn5ih8J+YoSAiICsgZSk7CiB6ay5zZW5kTWVzc2FnZShvcmlnaW5lTWVzc2FnZSwgeyB0ZXh0OiAi8J+YofCfmKEgIiArIGUgfSwgeyBxdW90ZWQ6IG1zIH0pOwogfQogfQogfQogLy9maW4gZXjDqWN1dGlvbiBjb21tYW5kZXMKIH0pOwogLy9maW4gw6l2w6luZW1lbnQgbWVzc2FnZQoKLyoqKioqKioqIGV2ZW5lbWVudCBncm91cGUgdXBkYXRlICoqKioqKioqKioqKioqKiovCmNvbnN0IHsgcmVjdXBldmVudHMgfSA9IHJlcXVpcmUoJy4vYmRkL3dlbGNvbWUnKTsgCgp6ay5ldi5vbignZ3JvdXAtcGFydGljaXBhbnRzLnVwZGF0ZScsIGFzeW5jIChncm91cCkgPT4gewogY29uc29sZS5sb2coZ3JvdXApOwoKIGxldCBwcGdyb3VwOwogdHJ5IHsKIHBwZ3JvdXAgPSBhd2FpdCB6ay5wcm9maWxlUGljdHVyZVVybChncm91cC5pZCwgJ2ltYWdlJyk7CiB9IGNhdGNoIHsKIHBwZ3JvdXAgPSAnaHR0cHM6Ly9maWxlcy5jYXRib3gubW9lL2ZqZXFlYy5qcGcnOwogfQoKIHRyeSB7CiBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IHprLmdyb3VwTWV0YWRhdGEoZ3JvdXAuaWQpOwoKIGlmIChncm91cC5hY3Rpb24gPT0gJ2FkZCcgJiYgKGF3YWl0IHJlY3VwZXZlbnRzKGdyb3VwLmlkLCAid2VsY29tZSIpID09ICdvbicpKSB7CiBsZXQgbXNnID0gYPCfkYsgSGVsbG8KYDsKCiBsZXQgbWVtYnJlcyA9IGdyb3VwLnBhcnRpY2lwYW50czsKIGZvciAobGV0IG1lbWJyZSBvZiBtZW1icmVzKSB7CiBtc2cgKz0gYCAqQCR7bWVtYnJlLnNwbGl0KCJAIilbMF19KiBXZWxjb21lIHRvIE91ciBPZmZpY2lhbCBHcm91cCxgOwogfQoKIG1zZyArPSBgWW91IG1pZ2h0IHdhbnQgdG8gcmVhZCB0aGUgZ3JvdXAgRGVzY3JpcHRpb24gdG8gYXZvaWQgZ2V0dGluZyByZW1vdmVkLi4uCj4g4bSY4bSP4bSh4bSHyoDhtIfhtIUgypnKjyDhtIThtIBz4bSHyo/KgMqc4bSP4bSF4bSHcyBz4bSc4bSY4bSY4bSPyoDhtJsg4bSb4bSH4bSA4bSNLi5gOwoKIHprLnNlbmRNZXNzYWdlKGdyb3VwLmlkLCB7IGltYWdlOiB7IHVybDogcHBncm91cCB9LCBjYXB0aW9uOiBtc2csIG1lbnRpb25zOiBtZW1icmVzIH0pOwogfSBlbHNlIGlmIChncm91cC5hY3Rpb24gPT0gJ3JlbW92ZScgJiYgKGF3YWl0IHJlY3VwZXZlbnRzKGdyb3VwLmlkLCAiZ29vZGJ5ZSIpID09ICdvbicpKSB7CiBsZXQgbXNnID0gYEFub3RoZXIgZmVsbGFoIGRpZG4ndCBmZWVsIHNhZmUgaGVyZS4uLjtcbmA7CgogbGV0IG1lbWJyZXMgPSBncm91cC5wYXJ0aWNpcGFudHM7CiBmb3IgKGxldCBtZW1icmUgb2YgbWVtYnJlcykgewogbXNnICs9IGBAJHttZW1icmUuc3BsaXQoIkAiKVswXX0gZGVjaWRlZCB0byBsZWF2ZSB0aGUgZ3JvdXAuXG5gOwogfQoKIHprLnNlbmRNZXNzYWdlKGdyb3VwLmlkLCB7IHRleHQ6IG1zZywgbWVudGlvbnM6IG1lbWJyZXMgfSk7CgogfSBlbHNlIGlmIChncm91cC5hY3Rpb24gPT0gJ3Byb21vdGUnICYmIChhd2FpdCByZWN1cGV2ZW50cyhncm91cC5pZCwgImFudGlwcm9tb3RlIikgPT0gJ29uJykgKSB7CiAvLyBjb25zb2xlLmxvZyh6ay51c2VyLmlkKQogaWYgKGdyb3VwLmF1dGhvciA9PSBtZXRhZGF0YS5vd25lciB8fCBncm91cC5hdXRob3IgPT0gY29uZi5OVU1FUk9fT1dORVIgKyAnQHMud2hhdHNhcHAubmV0JyB8fCBncm91cC5hdXRob3IgPT0gZGVjb2RlSmlkKHprLnVzZXIuaWQpIHx8IGdyb3VwLmF1dGhvciA9PSBncm91cC5wYXJ0aWNpcGFudHNbMF0pIHsgY29uc29sZS5sb2coJ0NhcyBkZSBzdXBlclVzZXIgamUgZmFpcyByaWVuJykgO3JldHVybiA7fSA7CgoKIGF3YWl0IHprLmdyb3VwUGFydGljaXBhbnRzVXBkYXRlKGdyb3VwLmlkICxbZ3JvdXAuYXV0aG9yLGdyb3VwLnBhcnRpY2lwYW50c1swXV0sImRlbW90ZSIpIDsKCiB6ay5zZW5kTWVzc2FnZSgKIGdyb3VwLmlkLAogewogdGV4dCA6IGBAJHsoZ3JvdXAuYXV0aG9yKS5zcGxpdCgiQCIpWzBdfSBoYXMgdmlvbGF0ZWQgdGhlIGFudGktcHJvbW90aW9uIHJ1bGUsIHRoZXJlZm9yZSBib3RoICR7Z3JvdXAuYXV0aG9yLnNwbGl0KCJAIilbMF19IGFuZCBAJHsoZ3JvdXAucGFydGljaXBhbnRzWzBdKS5zcGxpdCgiQCIpWzBdfSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIGFkbWluaXN0cmF0aXZlIHJpZ2h0cy5gLAogbWVudGlvbnMgOiBbZ3JvdXAuYXV0aG9yLGdyb3VwLnBhcnRpY2lwYW50c1swXV0KIH0KICkKCiB9IGVsc2UgaWYgKGdyb3VwLmFjdGlvbiA9PSAnZGVtb3RlJyAmJiAoYXdhaXQgcmVjdXBldmVudHMoZ3JvdXAuaWQsICJhbnRpZGVtb3RlIikgPT0gJ29uJykgKSB7CgogaWYgKGdyb3VwLmF1dGhvciA9PSBtZXRhZGF0YS5vd25lciB8fCBncm91cC5hdXRob3IgPT0gY29uZi5OVU1FUk9fT1dORVIgKyAnQHMud2hhdHNhcHAubmV0JyB8fCBncm91cC5hdXRob3IgPT0gZGVjb2RlSmlkKHprLnVzZXIuaWQpIHx8IGdyb3VwLmF1dGhvciA9PSBncm91cC5wYXJ0aWNpcGFudHNbMF0pIHsgY29uc29sZS5sb2coJ0NhcyBkZSBzdXBlclVzZXIgamUgZmFpcyByaWVuJykgO3JldHVybiA7fSA7CgoKIGF3YWl0IHprLmdyb3VwUGFydGljaXBhbnRzVXBkYXRlKGdyb3VwLmlkICxbZ3JvdXAuYXV0aG9yXSwiZGVtb3RlIikgOwogYXdhaXQgemsuZ3JvdXBQYXJ0aWNpcGFudHNVcGRhdGUoZ3JvdXAuaWQgLCBbZ3JvdXAucGFydGljaXBhbnRzWzBdXSAsICJwcm9tb3RlIikKCiB6ay5zZW5kTWVzc2FnZSgKIGdyb3VwLmlkLAogewogdGV4dCA6IGBAJHsoZ3JvdXAuYXV0aG9yKS5zcGxpdCgiQCIpWzBdfSBoYXMgdmlvbGF0ZWQgdGhlIGFudGktZGVtb3Rpb24gcnVsZSBieSByZW1vdmluZyBAJHsoZ3JvdXAucGFydGljaXBhbnRzWzBdKS5zcGxpdCgiQCIpWzBdfS4gQ29uc2VxdWVudGx5LCBoZSBoYXMgYmVlbiBzdHJpcHBlZCBvZiBhZG1pbmlzdHJhdGl2ZSByaWdodHMuYCAsCiBtZW50aW9ucyA6IFtncm91cC5hdXRob3IsZ3JvdXAucGFydGljaXBhbnRzWzBdXQogfQogKQoKIH0gCgogfSBjYXRjaCAoZSkgewogY29uc29sZS5lcnJvcihlKTsKIH0KfSk7CgovKioqKioqKiogZmluIGQnZXZlbmVtZW50IGdyb3VwZSB1cGRhdGUgKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgoKIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKkNyb24gc2V0dXAgKi8KCiAKIGFzeW5jIGZ1bmN0aW9uIGFjdGl2YXRlQ3JvbnMoKSB7CiBjb25zdCBjcm9uID0gcmVxdWlyZSgnbm9kZS1jcm9uJyk7CiBjb25zdCB7IGdldENyb24gfSA9IHJlcXVpcmUoJy4vYmRkL2Nyb24nKTsKCiBsZXQgY3JvbnMgPSBhd2FpdCBnZXRDcm9uKCk7CiBjb25zb2xlLmxvZyhjcm9ucyk7CiBpZiAoY3JvbnMubGVuZ3RoID4gMCkgewogCiBmb3IgKGxldCBpID0gMDsgaSA8IGNyb25zLmxlbmd0aDsgaSsrKSB7CiAKIGlmIChjcm9uc1tpXS5tdXRlX2F0ICE9IG51bGwpIHsKIGxldCBzZXQgPSBjcm9uc1tpXS5tdXRlX2F0LnNwbGl0KCc6Jyk7CgogY29uc29sZS5sb2coYEVzdGFibGlzaG1lbnQgb2Ygb25lIGZhbGwgdG8gJHtjcm9uc1tpXS5ncm91cF9pZH0gYSAke3NldFswXX0gSCAke3NldFsxXX1gKQoKIGNyb24uc2NoZWR1bGUoYCR7c2V0WzFdfSAke3NldFswXX0gKiAqICpgLCBhc3luYyAoKSA9PiB7CiBhd2FpdCB6ay5ncm91cFNldHRpbmdVcGRhdGUoY3JvbnNbaV0uZ3JvdXBfaWQsICdhbm5vdW5jZW1lbnQnKTsKIHprLnNlbmRNZXNzYWdlKGNyb25zW2ldLmdyb3VwX2lkLCB7IGltYWdlIDogeyB1cmwgOiAnLi9tZWRpYS9jaHJvbm8ud2VicCd9ICwgY2FwdGlvbjogIkhlbGxvLCBpdCdzIHRpbWUgdG8gY2xvc2UgdGhlIGdyb3VwOyBteSBzYXlhcmQuIiB9KTsKCiB9LCB7CiB0aW1lem9uZTogIkFmcmljYS9OYWlyb2JpIgogfSk7CiB9CiAKIGlmIChjcm9uc1tpXS51bm11dGVfYXQgIT0gbnVsbCkgewogbGV0IHNldCA9IGNyb25zW2ldLnVubXV0ZV9hdC5zcGxpdCgnOicpOwoKIGNvbnNvbGUubG9nKGBFc3RhYmxpc2htZW50IG9mIGEgc2VsZiAtZm91bmRlciBmb3IgJHtzZXRbMF19IEggJHtzZXRbMV19IGApCiAKIGNyb24uc2NoZWR1bGUoYCR7c2V0WzFdfSAke3NldFswXX0gKiAqICpgLCBhc3luYyAoKSA9PiB7CgogYXdhaXQgemsuZ3JvdXBTZXR0aW5nVXBkYXRlKGNyb25zW2ldLmdyb3VwX2lkLCAnbm90X2Fubm91bmNlbWVudCcpOwoKIHprLnNlbmRNZXNzYWdlKGNyb25zW2ldLmdyb3VwX2lkLCB7IGltYWdlIDogeyB1cmwgOiAnLi9tZWRpYS9jaHJvbm8ud2VicCd9ICwgY2FwdGlvbjogIkdvb2QgbW9ybmluZzsgSXQncyB0aW1lIHRvIG9wZW4gdGhlIGdyb3VwLiIgfSk7CgogCiB9LHsKIHRpbWV6b25lOiAiQWZyaWNhL05haXJvYmkiCiB9KTsKIH0KIAogfQogfSBlbHNlIHsKIGNvbnNvbGUubG9nKCdUaGUgY3JlYW1zIHdlcmUgbm90IGFjdGl2YXRlZCcpOwogfQoKIHJldHVybgogfQoKIAogLy/DqXbDqW5lbWVudCBjb250YWN0CiB6ay5ldi5vbigiY29udGFjdHMudXBzZXJ0IiwgYXN5bmMgKGNvbnRhY3RzKSA9PiB7CiBjb25zdCBpbnNlcnRDb250YWN0ID0gKG5ld0NvbnRhY3QpID0+IHsKIGZvciAoY29uc3QgY29udGFjdCBvZiBuZXdDb250YWN0KSB7CiBpZiAoc3RvcmUuY29udGFjdHNbY29udGFjdC5pZF0pIHsKIE9iamVjdC5hc3NpZ24oc3RvcmUuY29udGFjdHNbY29udGFjdC5pZF0sIGNvbnRhY3QpOwogfQogZWxzZSB7CiBzdG9yZS5jb250YWN0c1tjb250YWN0LmlkXSA9IGNvbnRhY3Q7CiB9CiB9CiByZXR1cm47CiB9OwogaW5zZXJ0Q29udGFjdChjb250YWN0cyk7CiB9KTsKIC8vZmluIMOpdsOpbmVtZW50IGNvbnRhY3QgCiAvL8OpdsOpbmVtZW50IGNvbm5leGlvbgogemsuZXYub24oImNvbm5lY3Rpb24udXBkYXRlIiwgYXN5bmMgKGNvbikgPT4gewogY29uc3QgeyBsYXN0RGlzY29ubmVjdCwgY29ubmVjdGlvbiB9ID0gY29uOwogaWYgKGNvbm5lY3Rpb24gPT09ICJjb25uZWN0aW5nIikgewogY29uc29sZS5sb2coIuKEue+4jyBjYXNleXJob2RlcyBtZCBjb25uZWN0aW5nIGluIHlvdXIgYWNjb3VudC4uLiIpOwogfQogZWxzZSBpZiAoY29ubmVjdGlvbiA9PT0gJ29wZW4nKSB7CiBjb25zb2xlLmxvZygi4pyFIENhc2V5cmhvZGVzIE1kIGNvbm5lY3RlZCBzdWNjZXNzZnVsbHnimLrvuI8iKTsKIGNvbnNvbGUubG9nKCItLSIpOwogYXdhaXQgKDAsIGJhaWxleXNfMS5kZWxheSkoMjAwKTsKIGNvbnNvbGUubG9nKCItLS0tLS0iKTsKIGF3YWl0ICgwLCBiYWlsZXlzXzEuZGVsYXkpKDMwMCk7CiBjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tLS0tLS0tLy0tLS0tIik7CiBjb25zb2xlLmxvZygiIENhc2V5cmhvZGVzIGxvYWRpbmcgcGx1Z2luc/CfmIdcblxuIik7CiAvL2NoYXJnZW1lbnQgZGVzIGNvbW1hbmRlcyAKIGNvbnNvbGUubG9nKCJjaGFyZ2VtZW50IGRlcyBwbHVnaW5zIC4uLlxuIik7CiBmcy5yZWFkZGlyU3luYyhfX2Rpcm5hbWUgKyAiL2NvbW1hbmRlcyIpLmZvckVhY2goKGZpY2hpZXIpID0+IHsKIGlmIChwYXRoLmV4dG5hbWUoZmljaGllcikudG9Mb3dlckNhc2UoKSA9PSAoIi5qcyIpKSB7CiB0cnkgewogcmVxdWlyZShfX2Rpcm5hbWUgKyAiL2NvbW1hbmRlcy8iICsgZmljaGllcik7CiBjb25zb2xlLmxvZyhmaWNoaWVyICsgIiBMb2FkZWQgc3VjY2Vzc2Z1bGx5IGJ5IENhc2V5cmhvZGVz4pyU77iPIik7CiB9CiBjYXRjaCAoZSkgewogY29uc29sZS5sb2coYCR7ZmljaGllcn0gY291bGQgbm90IGJlIGxvYWRlZCBmb3IgdGhlIGZvbGxvd2luZyByZWFzb25zIDogJHtlfWApOwogfSAvKiByZXF1aXJlKF9fZGlybmFtZSArICIvY29tbWFuZGVzLyIgKyBmaWNoaWVyKTsKIGNvbnNvbGUubG9nKGZpY2hpZXIgKyAiIGluc3RhbGzDqSDinJTvuI8iKSovCiAoMCwgYmFpbGV5c18xLmRlbGF5KSgzMDApOwogfQogfSk7CiAoMCwgYmFpbGV5c18xLmRlbGF5KSg3MDApOwogdmFyIG1kOwogaWYgKChjb25mLk1PREUpLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09ICJ5ZXMiKSB7CiBtZCA9ICJwdWJsaWMiOwogfQogZWxzZSBpZiAoKGNvbmYuTU9ERSkudG9Mb2NhbGVMb3dlckNhc2UoKSA9PT0gIm5vIikgewogbWQgPSAicHJpdmF0ZSI7CiB9CiBlbHNlIHsKIG1kID0gInVuZGVmaW5lZCI7CiB9CiBjb25zb2xlLmxvZygiQ2FzZXlyaG9kZXMgbWQgc3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZOKchSIpOwoKIGF3YWl0IGFjdGl2YXRlQ3JvbnMoKTsKIAogaWYoKGNvbmYuRFApLnRvTG93ZXJDYXNlKCkgPT09ICd5ZXMnKSB7IAogbGV0IGNtc2cgPSBgCiDila3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIHilIjiircgCiDilIIg4bSE4bSAc+G0h8qPyoDKnOG0j+G0heG0h3Mg4bSb4bSH4bSEypwKIOKUgiDhtJjKgOG0h9KTyap4IDogWyAke3ByZWZpeGV9IF0KIOKUgiDhtI3htI/htIXhtIcgOiR7bWR9CiDilIIg4bSE4bSP4bSN4bSN4bSAybThtIVzIDogJHtldnQuY20ubGVuZ3Rofe+4jgog4pSCIMqZ4bSP4bSbIMm04bSA4bSN4bSHIDog4bSE4bSAc+G0h8qPyoDKnOG0j+G0heG0h3Mg4bSN4bSFCiDilIIg4bSEypzhtIDJtMm04bSHyp8gOiBodHRwczovL3Rpbnl1cmwuY29tLzI2a2g2anNzCiDilIIgypnhtI/htJvKgOG0h+G0mOG0jyA6IGh0dHBzOi8vdGlueXVybC5jb20vMjkzZm5iNXEKIOKVreKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgeKUiOKKtyAKIOKUguG0hOG0gHPhtIfKj8qAypzhtI/htIXhtIdzLeG0jeG0hSDhtIThtI/JtMm04bSH4bSE4bSb4bSH4bSF4pyFCiDilbDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIHilIjiirdgOwogYXdhaXQgemsuc2VuZE1lc3NhZ2UoIHprLnVzZXIuaWQsIHsgdGV4dDogY21zZyB9KTsKIH0KIH0KIGVsc2UgaWYgKGNvbm5lY3Rpb24gPT0gImNsb3NlIikgewogbGV0IHJhaXNvbkRlY29ubmV4aW9uID0gbmV3IGJvb21fMS5Cb29tKGxhc3REaXNjb25uZWN0Py5lcnJvcik/Lm91dHB1dC5zdGF0dXNDb2RlOwogaWYgKHJhaXNvbkRlY29ubmV4aW9uID09PSBiYWlsZXlzXzEuRGlzY29ubmVjdFJlYXNvbi5iYWRTZXNzaW9uKSB7CiBjb25zb2xlLmxvZygnV3Jvbmcgc2Vzc2lvbiBJZCBmb3JtYXQsIHJlc2NhbiBhZ2Fpbi4uLicpOwogfQogZWxzZSBpZiAocmFpc29uRGVjb25uZXhpb24gPT09IGJhaWxleXNfMS5EaXNjb25uZWN0UmVhc29uLmNvbm5lY3Rpb25DbG9zZWQpIHsKIGNvbnNvbGUubG9nKCchISEgQ2xvc2VkIGNvbm5lY3Rpb24sIGN1cnJlbnQgcmVjb25uZWN0aW9uIC4uLicpOwogbWFpbigpOwogfQogZWxzZSBpZiAocmFpc29uRGVjb25uZXhpb24gPT09IGJhaWxleXNfMS5EaXNjb25uZWN0UmVhc29uLmNvbm5lY3Rpb25Mb3N0KSB7CiBjb25zb2xlLmxvZygnY29ubmVjdGlvbiBlcnJvcvCfmJ4gLCwgY2FzZXlyaG9kZXMgdHJ5aW5nIHRvIHJlY29ubmVjdC4uLiAnKTsKIG1haW4oKTsKIH0KIGVsc2UgaWYgKHJhaXNvbkRlY29ubmV4aW9uID09PSBiYWlsZXlzXzEuRGlzY29ubmVjdFJlYXNvbj8uY29ubmVjdGlvblJlcGxhY2VkKSB7CiBjb25zb2xlLmxvZygnQ29ubmVjdGlvbiByZXBsYWNlZCAsLCwgYSBzZXNzaW9uIGlzIGFscmVhZHkgb3BlbiBwbGVhc2UgdGhlIGZhcm0gcGxlYXNlICEhIScpOwogfQogZWxzZSBpZiAocmFpc29uRGVjb25uZXhpb24gPT09IGJhaWxleXNfMS5EaXNjb25uZWN0UmVhc29uLmxvZ2dlZE91dCkgewogY29uc29sZS5sb2coJ3Nlc3Npb24gZGlzY29ubmVjdGVkLCwsIHJlcGxhY2UgYSBuZXcgc2Vzc2lvbiBpZCcpOwogfQogZWxzZSBpZiAocmFpc29uRGVjb25uZXhpb24gPT09IGJhaWxleXNfMS5EaXNjb25uZWN0UmVhc29uLnJlc3RhcnRSZXF1aXJlZCkgewogY29uc29sZS5sb2coJ1Jlc3RhcnRpbmcgaW4gcHJvZ3Jlc3Mg4pa2IO+4jycpOwogbWFpbigpOwogfSBlbHNlIHsKCiBjb25zb2xlLmxvZygncmVzdGFydGluZyBvbiB0aGUgZXJyb3Igc3Ryb2tlICcscmFpc29uRGVjb25uZXhpb24pIDsgCiAvL3JlcG9uZHJlKCIqIFJlZMOpbWFycmFnZSBkdSBib3QgZW4gY291ciAuLi4qIik7CgogY29uc3Qge2V4ZWN9PXJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKSA7CgogZXhlYygicG0yIHJlc3RhcnQgYWxsIik7IAogfQogLy8gc2xlZXAoNTAwMDApCiBjb25zb2xlLmxvZygiaHVtICIgKyBjb25uZWN0aW9uKTsKIG1haW4oKTsgLy9jb25zb2xlLmxvZyhzZXNzaW9uKQogfQogfSk7CiAvL2ZpbiDDqXbDqW5lbWVudCBjb25uZXhpb24KIC8vw6l2w6luZW1lbnQgYXV0aGVudGlmaWNhdGlvbiAKIHprLmV2Lm9uKCJjcmVkcy51cGRhdGUiLCBzYXZlQ3JlZHMpOwogLy9maW4gw6l2w6luZW1lbnQgYXV0aGVudGlmaWNhdGlvbiAKIC8vCiAvKiogKioqKioqKioqKioqKiAqLwogLy9mb25jdGlvbnMgdXRpbGVzCiB6ay5kb3dubG9hZEFuZFNhdmVNZWRpYU1lc3NhZ2UgPSBhc3luYyAobWVzc2FnZSwgZmlsZW5hbWUgPSAnJywgYXR0YWNoRXh0ZW5zaW9uID0gdHJ1ZSkgPT4gewogbGV0IHF1b3RlZCA9IG1lc3NhZ2UubXNnID8gbWVzc2FnZS5tc2cgOiBtZXNzYWdlOwogbGV0IG1pbWUgPSAobWVzc2FnZS5tc2cgfHwgbWVzc2FnZSkubWltZXR5cGUgfHwgJyc7CiBsZXQgbWVzc2FnZVR5cGUgPSBtZXNzYWdlLm10eXBlID8gbWVzc2FnZS5tdHlwZS5yZXBsYWNlKC9NZXNzYWdlL2dpLCAnJykgOiBtaW1lLnNwbGl0KCcvJylbMF07CiBjb25zdCBzdHJlYW0gPSBhd2FpdCAoMCwgYmFpbGV5c18xLmRvd25sb2FkQ29udGVudEZyb21NZXNzYWdlKShxdW90ZWQsIG1lc3NhZ2VUeXBlKTsKIGxldCBidWZmZXIgPSBCdWZmZXIuZnJvbShbXSk7CiBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHN0cmVhbSkgewogYnVmZmVyID0gQnVmZmVyLmNvbmNhdChbYnVmZmVyLCBjaHVua10pOwogfQogbGV0IHR5cGUgPSBhd2FpdCBGaWxlVHlwZS5mcm9tQnVmZmVyKGJ1ZmZlcik7CiBsZXQgdHJ1ZUZpbGVOYW1lID0gJy4vJyArIGZpbGVuYW1lICsgJy4nICsgdHlwZS5leHQ7CiAvLyBzYXZlIHRvIGZpbGUKIGF3YWl0IGZzLndyaXRlRmlsZVN5bmModHJ1ZUZpbGVOYW1lLCBidWZmZXIpOwogcmV0dXJuIHRydWVGaWxlTmFtZTsKIH07CgoKIHprLmF3YWl0Rm9yTWVzc2FnZSA9IGFzeW5jIChvcHRpb25zID0ge30pID0+ewogcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gJ29iamVjdCcpIHJlamVjdChuZXcgRXJyb3IoJ09wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QnKSk7CiBpZiAodHlwZW9mIG9wdGlvbnMuc2VuZGVyICE9PSAnc3RyaW5nJykgcmVqZWN0KG5ldyBFcnJvcignU2VuZGVyIG11c3QgYmUgYSBzdHJpbmcnKSk7CiBpZiAodHlwZW9mIG9wdGlvbnMuY2hhdEppZCAhPT0gJ3N0cmluZycpIHJlamVjdChuZXcgRXJyb3IoJ0NoYXRKaWQgbXVzdCBiZSBhIHN0cmluZycpKTsKIGlmIChvcHRpb25zLnRpbWVvdXQgJiYgdHlwZW9mIG9wdGlvbnMudGltZW91dCAhPT0gJ251bWJlcicpIHJlamVjdChuZXcgRXJyb3IoJ1RpbWVvdXQgbXVzdCBiZSBhIG51bWJlcicpKTsKIGlmIChvcHRpb25zLmZpbHRlciAmJiB0eXBlb2Ygb3B0aW9ucy5maWx0ZXIgIT09ICdmdW5jdGlvbicpIHJlamVjdChuZXcgRXJyb3IoJ0ZpbHRlciBtdXN0IGJlIGEgZnVuY3Rpb24nKSk7CiAKIGNvbnN0IHRpbWVvdXQgPSBvcHRpb25zPy50aW1lb3V0IHx8IHVuZGVmaW5lZDsKIGNvbnN0IGZpbHRlciA9IG9wdGlvbnM/LmZpbHRlciB8fCAoKCkgPT4gdHJ1ZSk7CiBsZXQgaW50ZXJ2YWwgPSB1bmRlZmluZWQKIAogLyoqCiAqIAogKiBAcGFyYW0ge3ttZXNzYWdlczogQmFpbGV5cy5wcm90by5JV2ViTWVzc2FnZUluZm9bXSwgdHlwZTogQmFpbGV5cy5NZXNzYWdlVXBzZXJ0VHlwZX19IGRhdGEgCiAqLwogbGV0IGxpc3RlbmVyID0gKGRhdGEpID0+IHsKIGxldCB7IHR5cGUsIG1lc3NhZ2VzIH0gPSBkYXRhOwogaWYgKHR5cGUgPT0gIm5vdGlmeSIpIHsKIGZvciAobGV0IG1lc3NhZ2Ugb2YgbWVzc2FnZXMpIHsKIGNvbnN0IGZyb21NZSA9IG1lc3NhZ2Uua2V5LmZyb21NZTsKIGNvbnN0IGNoYXRJZCA9IG1lc3NhZ2Uua2V5LnJlbW90ZUppZDsKIGNvbnN0IGlzR3JvdXAgPSBjaGF0SWQuZW5kc1dpdGgoJ0BnLnVzJyk7CiBjb25zdCBpc1N0YXR1cyA9IGNoYXRJZCA9PSAnc3RhdHVzQGJyb2FkY2FzdCc7CiAKIGNvbnN0IHNlbmRlciA9IGZyb21NZSA/IHprLnVzZXIuaWQucmVwbGFjZSgvOi4qQC9nLCAnQCcpIDogKGlzR3JvdXAgfHwgaXNTdGF0dXMpID8gbWVzc2FnZS5rZXkucGFydGljaXBhbnQucmVwbGFjZSgvOi4qQC9nLCAnQCcpIDogY2hhdElkOwogaWYgKHNlbmRlciA9PSBvcHRpb25zLnNlbmRlciAmJiBjaGF0SWQgPT0gb3B0aW9ucy5jaGF0SmlkICYmIGZpbHRlcihtZXNzYWdlKSkgewogemsuZXYub2ZmKCdtZXNzYWdlcy51cHNlcnQnLCBsaXN0ZW5lcik7CiBjbGVhclRpbWVvdXQoaW50ZXJ2YWwpOwogcmVzb2x2ZShtZXNzYWdlKTsKIH0KIH0KIH0KIH0KIHprLmV2Lm9uKCdtZXNzYWdlcy51cHNlcnQnLCBsaXN0ZW5lcik7CiBpZiAodGltZW91dCkgewogaW50ZXJ2YWwgPSBzZXRUaW1lb3V0KCgpID0+IHsKIHprLmV2Lm9mZignbWVzc2FnZXMudXBzZXJ0JywgbGlzdGVuZXIpOwogcmVqZWN0KG5ldyBFcnJvcignVGltZW91dCcpKTsKIH0sIHRpbWVvdXQpOwogfQogfSk7CiB9CgoKCiAvLyBmaW4gZm9uY3Rpb25zIHV0aWxlcwogLyoqICoqKioqKioqKioqKiogKi8KIHJldHVybiB6azsKIH0KIGxldCBmaWNoaWVyID0gcmVxdWlyZS5yZXNvbHZlKF9fZmlsZW5hbWUpOwogZnMud2F0Y2hGaWxlKGZpY2hpZXIsICgpID0+IHsKIGZzLnVud2F0Y2hGaWxlKGZpY2hpZXIpOwogY29uc29sZS5sb2coYHVwZGF0ZSAke19fZmlsZW5hbWV9YCk7CiBkZWxldGUgcmVxdWlyZS5jYWNoZVtmaWNoaWVyXTsKIHJlcXVpcmUoZmljaGllcik7CiB9KTsKIG1haW4oKTsKfSwgNTAwMCk7
